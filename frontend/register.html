<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="description" content="교육 교육신청서 페이지">
    <meta name="theme-color" content="#3B82F6">

    <!-- Open Graph 메타 태그 (URL 공유 시 미리보기) -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="교육관리시스템 - 교육신청서">
    <meta property="og:description" content="온라인으로 간편하게 수강신청하세요">
    <meta property="og:image" content="/og-image.png">
    <meta property="og:url" content="/register.html">
    <meta property="og:site_name" content="교육관리시스템">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="교육관리시스템 - 교육신청서">
    <meta name="twitter:description" content="온라인으로 간편하게 수강신청하세요">
    <meta name="twitter:image" content="/og-image.png">

    <title>교육관리시스템 - 교육신청서</title>

    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">

    <!-- 테마 및 로고 즉시 적용 -->
    <script>
        var __THEME_COLOR__ = null;
        var __LOGO_URL__ = null;
        try {
            const savedTheme = localStorage.getItem('system_theme');
            if (savedTheme) {
                const theme = JSON.parse(savedTheme);
                if (theme && theme.menubar) {
                    __THEME_COLOR__ = theme.menubar;
                }
            }
            __LOGO_URL__ = localStorage.getItem('logo_url');

            // 파비콘을 로고로 설정
            if (__LOGO_URL__) {
                let faviconUrl = __LOGO_URL__;
                if (__LOGO_URL__.startsWith('ftp://')) {
                    faviconUrl = '/api/download-image?url=' + encodeURIComponent(__LOGO_URL__);
                }
                const favicon = document.querySelector('link[rel="icon"]');
                if (favicon) favicon.href = faviconUrl;
            }
        } catch(e) {
            console.error('테마 로드 오류:', e);
        }
    </script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen py-8">
    <div class="container max-w-2xl mx-auto px-4">
        <!-- 가입 카드 -->
        <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
            <!-- 헤더 -->
            <script>document.write('<div id="register-header" class="p-6 text-center" style="background: ' + (__THEME_COLOR__ || '#2563eb') + ';">');</script>
                <div class="inline-block bg-white rounded-lg overflow-hidden mb-3" style="width: 160px; height: 64px;">
                    <script>
                        var logoSrc = __LOGO_URL__ || '/woosong-logo.png';
                        if (logoSrc.startsWith('ftp://')) {
                            logoSrc = '/api/download-image?url=' + encodeURIComponent(logoSrc);
                        }
                        document.write('<img id="register-logo" src="' + logoSrc + '" alt="로고" style="width: 100%; height: 100%; object-fit: fill;">');
                    </script>
                </div>
                <h1 id="system-title-register" class="text-xl font-bold text-white mb-1">교육신청서</h1>
                <p class="text-blue-100 text-sm" id="system-subtitle1-register">아래 정보를 입력해주세요</p>
            </div>

            <!-- 가입 폼 -->
            <div class="p-6">
                <form id="registerForm" class="space-y-4">
                    <!-- 과정 선택 (필수) - 맨 위 -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-book mr-1"></i>신청 과정 <span class="text-red-500">*</span>
                        </label>
                        <select
                            id="courseCode"
                            class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none"
                            required
                        >
                            <option value="">과정을 선택하세요</option>
                        </select>
                    </div>

                    <!-- 이름 (필수) -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-user mr-1"></i>이름 <span class="text-red-500">*</span>
                        </label>
                        <input
                            type="text"
                            id="name"
                            placeholder="이름을 입력하세요"
                            class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none"
                            required
                        >
                    </div>

                    <!-- 생년월일 (필수 - 로그인에 사용) -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-birthday-cake mr-1"></i>생년월일 <span class="text-red-500">*</span>
                        </label>
                        <input
                            type="text"
                            id="birthDate"
                            placeholder="예: 900115 (6자리)"
                            class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none"
                            required
                        >
                        <p class="text-xs text-gray-500 mt-1">* 로그인 비밀번호로 사용됩니다</p>
                    </div>

                    <!-- 성별 -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-venus-mars mr-1"></i>성별
                        </label>
                        <div class="flex gap-4">
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="gender" value="남" class="mr-2">
                                <span>남</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="gender" value="여" class="mr-2">
                                <span>여</span>
                            </label>
                        </div>
                    </div>

                    <!-- 휴대폰 (필수) -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-phone mr-1"></i>휴대폰 <span class="text-red-500">*</span>
                        </label>
                        <input
                            type="tel"
                            id="phone"
                            placeholder="010-0000-0000"
                            class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none"
                            required
                            oninput="formatPhoneNumber(this)"
                        >
                    </div>

                    <!-- 이메일 -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-envelope mr-1"></i>이메일
                        </label>
                        <input
                            type="email"
                            id="email"
                            placeholder="example@email.com"
                            class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none"
                        >
                    </div>

                    <!-- 주소 -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-map-marker-alt mr-1"></i>주소
                        </label>
                        <input
                            type="text"
                            id="address"
                            placeholder="주소를 입력하세요"
                            class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none"
                        >
                    </div>

                    <!-- 학력 -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-graduation-cap mr-1"></i>학력(학력무관선발가능)
                        </label>
                        <input
                            type="text"
                            id="education"
                            placeholder="예: 00대학교 00학과 졸업"
                            class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none"
                        >
                    </div>

                    <!-- 관심분야 (체크박스) -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-heart mr-1"></i>관심분야
                        </label>
                        <div id="interestCheckboxes" class="grid grid-cols-2 md:grid-cols-3 gap-2 p-3 border-2 border-gray-200 rounded-lg bg-gray-50">
                            <!-- 체크박스가 동적으로 추가됩니다 -->
                            <p class="text-gray-400 text-sm col-span-full">로딩 중...</p>
                        </div>
                        <input type="hidden" id="interests">
                    </div>

                    <!-- 자기소개 -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-comment mr-1"></i>자기소개
                        </label>
                        <textarea
                            id="introduction"
                            rows="3"
                            placeholder="간단한 자기소개를 입력하세요"
                            class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none resize-none"
                        ></textarea>
                    </div>

                    <!-- 프로필 사진 -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">
                            <i class="fas fa-camera mr-1"></i>프로필 사진
                        </label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
                            <!-- 미리보기 -->
                            <div id="photoPreviewContainer" class="hidden mb-4">
                                <img id="photoPreview" src="" alt="프로필 미리보기" class="w-32 h-32 mx-auto rounded-full object-cover border-4 border-blue-200">
                                <button type="button" onclick="removePhoto()" class="mt-2 text-red-500 text-sm hover:text-red-700">
                                    <i class="fas fa-trash mr-1"></i>사진 삭제
                                </button>
                            </div>
                            <!-- 업로드 버튼들 -->
                            <div id="photoButtons" class="flex flex-col sm:flex-row gap-2 justify-center">
                                <label class="cursor-pointer bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-all inline-flex items-center justify-center">
                                    <i class="fas fa-upload mr-2"></i>사진 업로드
                                    <input type="file" id="photoUpload" accept="image/*" class="hidden" onchange="handlePhotoUpload(event)">
                                </label>
                                <button type="button" onclick="openCamera()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-all inline-flex items-center justify-center">
                                    <i class="fas fa-camera mr-2"></i>카메라 촬영
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">JPG, PNG 파일 (최대 5MB)</p>
                        </div>
                        <input type="hidden" id="profilePhoto">
                    </div>

                    <!-- 카메라 모달 -->
                    <div id="cameraModal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50">
                        <div class="bg-white rounded-2xl p-4 max-w-lg w-full mx-4">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-bold"><i class="fas fa-camera mr-2"></i>카메라 촬영</h3>
                                <button onclick="closeCamera()" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <div class="relative">
                                <video id="cameraVideo" autoplay playsinline class="w-full rounded-lg bg-black"></video>
                                <canvas id="cameraCanvas" class="hidden"></canvas>
                            </div>
                            <div class="flex gap-2 mt-4">
                                <button type="button" onclick="capturePhoto()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-bold">
                                    <i class="fas fa-camera mr-2"></i>촬영
                                </button>
                                <button type="button" onclick="closeCamera()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg font-bold">
                                    <i class="fas fa-times mr-2"></i>취소
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 버튼 영역 -->
                    <div class="flex gap-3 pt-4">
                        <button
                            type="button"
                            onclick="window.location.href='/login.html'"
                            class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 rounded-lg transition-all"
                        >
                            <i class="fas fa-arrow-left mr-2"></i>취소
                        </button>
                        <button
                            type="submit"
                            id="submitButton"
                            class="flex-1 text-white font-bold py-3 rounded-lg transition-all transform hover:scale-[1.02] active:scale-[0.98] shadow-lg hover:opacity-90"
                            style="background: #2563eb;"
                        >
                            <i class="fas fa-paper-plane mr-2"></i>신청하기
                        </button>
                    </div>
                    <script>
                        if (__THEME_COLOR__) {
                            document.getElementById('submitButton').style.background = __THEME_COLOR__;
                        }
                    </script>
                </form>

                <!-- 알림 메시지 -->
                <div id="alertMessage" class="hidden mt-4 p-4 rounded-lg"></div>
            </div>
        </div>

        <!-- 푸터 -->
        <div class="text-center mt-6 text-gray-600 text-sm">
            <p>© 2025 교육관리시스템. All rights reserved.</p>
        </div>
    </div>

    <!-- 성공 모달 -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md mx-4 text-center">
            <div class="text-green-500 text-6xl mb-4">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-4">신청이 완료되었습니다!</h2>
            <p class="text-gray-600 mb-2">이제 <strong>이름</strong>과 <strong>생년월일 6자리</strong>로 로그인이 가능합니다.</p>
            <p class="text-gray-500 text-sm mb-6">로그인 후 승인 과정을 확인하실 수 있습니다.</p>
            <button
                onclick="window.location.href='/login.html'"
                id="modalCloseButton"
                class="w-full text-white font-bold py-3 rounded-lg transition-all hover:opacity-90"
                style="background: #2563eb;"
            >
                <i class="fas fa-sign-in-alt mr-2"></i>로그인하러 가기
            </button>
            <script>
                if (__THEME_COLOR__) {
                    document.getElementById('modalCloseButton').style.background = __THEME_COLOR__;
                }
            </script>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script>
        const API_BASE_URL = window.location.origin.replace('3000', '8000');

        // 페이지 로드 시 모집중인 과정 불러오기
        async function loadOpenCourses() {
            try {
                // URL 파라미터에서 과정 코드 확인
                const urlParams = new URLSearchParams(window.location.search);
                const preselectedCourse = urlParams.get('course');

                // 시스템 설정에서 모집중인 과정 코드 목록 가져오기
                const settingsResponse = await axios.get(`${API_BASE_URL}/api/system-settings`);
                const openCourseCodes = settingsResponse.data.open_courses || '';

                // 전체 과정 목록 가져오기
                const coursesResponse = await axios.get(`${API_BASE_URL}/api/courses`);
                const allCourses = coursesResponse.data;

                const courseSelect = document.getElementById('courseCode');
                courseSelect.innerHTML = '<option value="">과정을 선택하세요</option>';

                // 모집중인 과정만 필터링
                let filteredCourses = allCourses;
                if (openCourseCodes && openCourseCodes.trim()) {
                    const openCodes = openCourseCodes.split(',').map(c => c.trim());
                    filteredCourses = allCourses.filter(course => openCodes.includes(course.code));
                }

                // 과정이 없으면 전체 표시
                if (filteredCourses.length === 0) {
                    filteredCourses = allCourses;
                }

                filteredCourses.forEach(course => {
                    const option = document.createElement('option');
                    option.value = course.code;
                    option.textContent = course.name;
                    courseSelect.appendChild(option);
                });

                // URL 파라미터로 전달된 과정이 있으면 자동 선택
                if (preselectedCourse) {
                    const exists = filteredCourses.some(c => c.code === preselectedCourse);
                    if (exists) {
                        courseSelect.value = preselectedCourse;
                        console.log('URL 파라미터로 과정 자동 선택:', preselectedCourse);
                    }
                }
                // 모집중인 과정이 1개일 때 자동 선택
                else if (filteredCourses.length === 1) {
                    courseSelect.value = filteredCourses[0].code;
                }

                console.log('모집중인 과정 로드 완료:', filteredCourses.length + '개');
            } catch (error) {
                console.error('과정 로드 실패:', error);
            }
        }

        // 시스템 설정 로드
        async function loadSystemSettings() {
            try {
                const response = await axios.get(`${API_BASE_URL}/api/system-settings`);
                const settings = response.data;

                // 제목 업데이트
                const systemTitle = settings.system_title || '교육관리시스템';
                document.title = systemTitle + ' - 교육신청서';

                // 로고 업데이트
                const logoImg = document.getElementById('register-logo');
                if (logoImg && settings.logo_url) {
                    if (settings.logo_url.startsWith('ftp://')) {
                        logoImg.src = API_BASE_URL + '/api/download-image?url=' + encodeURIComponent(settings.logo_url);
                    } else {
                        logoImg.src = settings.logo_url;
                    }
                }

                // 관심분야 키워드 로드 및 체크박스 생성
                loadInterestKeywords(settings.interest_keywords || '');
            } catch (error) {
                console.error('시스템 설정 로드 실패:', error);
            }
        }

        // 관심분야 키워드 체크박스 생성
        function loadInterestKeywords(keywordsStr) {
            const container = document.getElementById('interestCheckboxes');
            container.innerHTML = '';

            if (!keywordsStr || !keywordsStr.trim()) {
                container.innerHTML = '<p class="text-gray-400 text-sm col-span-full">관심분야가 설정되지 않았습니다</p>';
                return;
            }

            const keywords = keywordsStr.split(',').map(k => k.trim()).filter(k => k);

            if (keywords.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-sm col-span-full">관심분야가 설정되지 않았습니다</p>';
                return;
            }

            keywords.forEach((keyword, idx) => {
                const label = document.createElement('label');
                label.className = 'flex items-center cursor-pointer p-2 rounded hover:bg-gray-100 transition-colors';
                label.innerHTML = `
                    <input type="checkbox" name="interest" value="${keyword}" class="mr-2 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <span class="text-sm text-gray-700">${keyword}</span>
                `;
                container.appendChild(label);
            });

            // 체크박스 변경 시 hidden input 업데이트
            container.querySelectorAll('input[name="interest"]').forEach(cb => {
                cb.addEventListener('change', updateInterestsInput);
            });
        }

        // 선택된 관심분야를 hidden input에 저장
        function updateInterestsInput() {
            const checkboxes = document.querySelectorAll('input[name="interest"]:checked');
            const selected = Array.from(checkboxes).map(cb => cb.value);
            document.getElementById('interests').value = selected.join(', ');
        }

        // 휴대폰 번호 자동 형식화 (000-0000-0000)
        function formatPhoneNumber(input) {
            let value = input.value.replace(/\D/g, ''); // 숫자만 추출

            if (value.length > 11) {
                value = value.substring(0, 11);
            }

            if (value.length > 7) {
                input.value = value.substring(0, 3) + '-' + value.substring(3, 7) + '-' + value.substring(7);
            } else if (value.length > 3) {
                input.value = value.substring(0, 3) + '-' + value.substring(3);
            } else {
                input.value = value;
            }
        }

        // 페이지 로드 시 실행
        window.addEventListener('DOMContentLoaded', () => {
            loadSystemSettings();
            loadOpenCourses();
        });

        // 카메라 관련 변수
        let cameraStream = null;

        // 프로필 사진 업로드 처리
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // 파일 크기 체크 (5MB)
            if (file.size > 5 * 1024 * 1024) {
                showAlert('파일 크기는 5MB 이하여야 합니다', 'error');
                event.target.value = '';
                return;
            }

            // 이미지 파일 체크
            if (!file.type.startsWith('image/')) {
                showAlert('이미지 파일만 업로드 가능합니다', 'error');
                event.target.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                setPhotoPreview(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        // 카메라 열기
        async function openCamera() {
            const cameraModal = document.getElementById('cameraModal');
            const video = document.getElementById('cameraVideo');

            try {
                cameraStream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'user', width: { ideal: 640 }, height: { ideal: 480 } }
                });
                video.srcObject = cameraStream;
                cameraModal.classList.remove('hidden');
                cameraModal.classList.add('flex');
            } catch (err) {
                console.error('카메라 접근 실패:', err);
                showAlert('카메라에 접근할 수 없습니다. 권한을 확인해주세요.', 'error');
            }
        }

        // 카메라 닫기
        function closeCamera() {
            const cameraModal = document.getElementById('cameraModal');
            const video = document.getElementById('cameraVideo');

            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
            video.srcObject = null;
            cameraModal.classList.add('hidden');
            cameraModal.classList.remove('flex');
        }

        // 사진 촬영
        function capturePhoto() {
            const video = document.getElementById('cameraVideo');
            const canvas = document.getElementById('cameraCanvas');
            const ctx = canvas.getContext('2d');

            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);

            const dataUrl = canvas.toDataURL('image/jpeg', 0.8);
            setPhotoPreview(dataUrl);
            closeCamera();
        }

        // 미리보기 설정
        function setPhotoPreview(dataUrl) {
            const preview = document.getElementById('photoPreview');
            const previewContainer = document.getElementById('photoPreviewContainer');
            const photoButtons = document.getElementById('photoButtons');

            preview.src = dataUrl;
            document.getElementById('profilePhoto').value = dataUrl;

            previewContainer.classList.remove('hidden');
            photoButtons.classList.add('hidden');
        }

        // 사진 삭제
        function removePhoto() {
            const preview = document.getElementById('photoPreview');
            const previewContainer = document.getElementById('photoPreviewContainer');
            const photoButtons = document.getElementById('photoButtons');

            preview.src = '';
            document.getElementById('profilePhoto').value = '';
            document.getElementById('photoUpload').value = '';

            previewContainer.classList.add('hidden');
            photoButtons.classList.remove('hidden');
        }

        // 생년월일 검증
        function validateBirthDate(birthDate) {
            if (!birthDate) return false;

            // 숫자만 추출
            const digits = birthDate.replace(/\D/g, '');

            // 6자리인지 확인
            if (digits.length !== 6) return false;

            // 유효한 날짜인지 확인
            const year = parseInt(digits.substring(0, 2));
            const month = parseInt(digits.substring(2, 4));
            const day = parseInt(digits.substring(4, 6));

            if (month < 1 || month > 12) return false;
            if (day < 1 || day > 31) return false;

            return true;
        }

        // 폼 제출
        const registerForm = document.getElementById('registerForm');
        const submitButton = document.getElementById('submitButton');
        const alertMessage = document.getElementById('alertMessage');
        const successModal = document.getElementById('successModal');

        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('name').value.trim();
            const courseCode = document.getElementById('courseCode').value;
            const phone = document.getElementById('phone').value.trim();
            const birthDate = document.getElementById('birthDate').value.trim();

            if (!name) {
                showAlert('이름을 입력하세요', 'error');
                return;
            }

            if (!courseCode) {
                showAlert('과정을 선택하세요', 'error');
                return;
            }

            // 생년월일 6자리 필수 검증
            if (!birthDate) {
                showAlert('생년월일을 입력하세요 (로그인 비밀번호로 사용됩니다)', 'error');
                document.getElementById('birthDate').focus();
                return;
            }

            if (!validateBirthDate(birthDate)) {
                showAlert('생년월일을 6자리 숫자로 입력하세요 (예: 900115)', 'error');
                document.getElementById('birthDate').focus();
                return;
            }

            if (!phone) {
                showAlert('휴대폰 번호를 입력하세요', 'error');
                return;
            }

            // 버튼 비활성화
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>신청 중...';

            try {
                const genderRadio = document.querySelector('input[name="gender"]:checked');

                const data = {
                    name: name,
                    course_code: courseCode,
                    birth_date: birthDate.replace(/\D/g, ''),  // 숫자만 저장
                    gender: genderRadio ? genderRadio.value : '',
                    phone: phone,
                    email: document.getElementById('email').value.trim(),
                    address: document.getElementById('address').value.trim(),
                    education: document.getElementById('education').value.trim(),
                    interests: document.getElementById('interests').value.trim(),
                    introduction: document.getElementById('introduction').value.trim(),
                    profile_photo: document.getElementById('profilePhoto').value
                };

                const response = await axios.post(`${API_BASE_URL}/api/student-registrations`, data);

                if (response.data.id) {
                    // 성공 모달 표시
                    successModal.classList.remove('hidden');
                    successModal.classList.add('flex');
                }
            } catch (error) {
                console.error('신청 오류:', error);
                const message = error.response?.data?.detail || '신청에 실패했습니다';
                showAlert(message, 'error');

                // 버튼 다시 활성화
                submitButton.disabled = false;
                submitButton.innerHTML = '<i class="fas fa-paper-plane mr-2"></i>신청하기';
            }
        });

        // 알림 메시지 표시
        function showAlert(message, type) {
            alertMessage.classList.remove('hidden', 'bg-red-100', 'text-red-800', 'bg-green-100', 'text-green-800');

            if (type === 'error') {
                alertMessage.classList.add('bg-red-100', 'text-red-800');
                alertMessage.innerHTML = `<i class="fas fa-exclamation-circle mr-2"></i>${message}`;
            } else if (type === 'success') {
                alertMessage.classList.add('bg-green-100', 'text-green-800');
                alertMessage.innerHTML = `<i class="fas fa-check-circle mr-2"></i>${message}`;
            }

            alertMessage.classList.remove('hidden');

            // 3초 후 자동 숨김
            setTimeout(() => {
                alertMessage.classList.add('hidden');
            }, 3000);
        }
    </script>
</body>
</html>
