<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="description" content="ë°”ì´ì˜¤í—¬ìŠ¤ êµìœ¡ ê´€ë¦¬ ëª¨ë°”ì¼ ì•±">
    <meta name="theme-color" content="#3B82F6">
    
    <!-- PWA ì„¤ì • - ì£¼ì†Œì°½ ìˆ¨ê¹€ -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ë°”ì´ì˜¤í—¬ìŠ¤">
    
    <!-- Fullscreen mode for PWA -->
    <meta name="display" content="standalone">
    <meta name="apple-touch-fullscreen" content="yes">
    
    <title>ë°”ì´ì˜¤í—¬ìŠ¤êµìœ¡ê´€ë¦¬ - ëª¨ë°”ì¼</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/mobile/manifest.json">
    
    <!-- Favicon and Icons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/mobile/icon-180x180.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/mobile/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="/mobile/icon-512x512.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- ë””ë°”ì´ìŠ¤ ê°ì§€ (ë°ìŠ¤í¬íƒ‘ì´ë©´ ë°ìŠ¤í¬íƒ‘ í˜ì´ì§€ë¡œ) -->
    <script>
        (function() {
            function isMobileDevice() {
                const ua = navigator.userAgent || navigator.vendor || window.opera;
                const mobileRegex = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i;
                const isSmallScreen = window.innerWidth <= 768;
                const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
                return mobileRegex.test(ua) || (isSmallScreen && isTouchDevice);
            }
            
            // ë°ìŠ¤í¬íƒ‘ ë””ë°”ì´ìŠ¤ê°€ ëª¨ë°”ì¼ í˜ì´ì§€ì— ì ‘ì†í•œ ê²½ìš°
            if (!isMobileDevice()) {
                console.log('ğŸ’» ë°ìŠ¤í¬íƒ‘ ë””ë°”ì´ìŠ¤ê°€ ëª¨ë°”ì¼ í˜ì´ì§€ ì ‘ì† - ë°ìŠ¤í¬íƒ‘ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸');
                window.location.replace('/index.html');
            } else {
                console.log('ğŸ“± ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤ - ëª¨ë°”ì¼ í˜ì´ì§€ ë¡œë“œ');
            }
        })();
    </script>
    
    <style>
        /* ëª¨ë°”ì¼ ìµœì í™” */
        body {
            -webkit-tap-highlight-color: transparent;
            touch-action: pan-y;
            overflow-x: hidden;
        }
        
        /* ìŠ¤ì™€ì´í”„ ì»¨í…Œì´ë„ˆ */
        #swipeContainer {
            display: flex;
            width: 200%;
            transition: transform 0.3s ease-out;
        }
        
        #swipeContainer.menu-active {
            transform: translateX(-50%);
        }
        
        #dashboardPage, #menuPage {
            width: 50%;
            min-height: 100vh;
        }
        
        /* ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        /* ì¹´ë“œ í˜¸ë²„ íš¨ê³¼ */
        .menu-card {
            transition: all 0.3s ease;
        }
        
        .menu-card:active {
            transform: scale(0.95);
        }
        
        /* í˜ì´ì§€ ì¸ë””ì¼€ì´í„° */
        .page-indicator {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 100;
        }
        
        .page-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transition: all 0.3s;
        }
        
        .page-dot.active {
            width: 24px;
            border-radius: 4px;
            background: white;
        }
        
        /* ìŠ¤ì™€ì´í”„ íŒíŠ¸ */
        .swipe-hint {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            animation: swipe-bounce 2s infinite;
            z-index: 50;
        }
        
        @keyframes swipe-bounce {
            0%, 100% { transform: translateY(-50%) translateX(0); }
            50% { transform: translateY(-50%) translateX(-10px); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100">
    
    <!-- ìŠ¤ì™€ì´í”„ ì»¨í…Œì´ë„ˆ -->
    <div id="swipeContainer">
        <!-- ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ -->
        <div id="dashboardPage">
            <!-- í—¤ë” -->
            <header class="bg-white shadow-md sticky top-0 z-50">
                <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-heartbeat text-3xl text-blue-600"></i>
                        <div>
                            <h1 class="text-xl font-bold text-gray-800">ëŒ€ì‹œë³´ë“œ</h1>
                            <p class="text-xs text-gray-600" id="userInfo">ë¡œë”©ì¤‘...</p>
                        </div>
                    </div>
                    <button onclick="logout()" 
                            class="text-red-500 hover:text-red-700 transition-colors px-3 py-2 rounded-lg hover:bg-red-50">
                        <i class="fas fa-sign-out-alt text-xl"></i>
                    </button>
                </div>
            </header>
            
            <!-- ëŒ€ì‹œë³´ë“œ ì»¨í…ì¸  -->
            <main class="max-w-7xl mx-auto px-4 py-6 pb-20">
                <div id="dashboardContent">
                    <p class="text-center py-8 text-gray-500">ë¡œë”©ì¤‘...</p>
                </div>
                
                <!-- ìŠ¤ì™€ì´í”„ íŒíŠ¸ (ì²« ë°©ë¬¸ ì‹œë§Œ) -->
                <div class="swipe-hint" id="swipeHint">
                    <div class="bg-white rounded-full p-3 shadow-lg">
                        <i class="fas fa-arrow-left text-2xl text-blue-600"></i>
                    </div>
                    <p class="text-xs text-gray-600 mt-2 text-center">ë©”ë‰´ â†’</p>
                </div>
            </main>
        </div>
        
        <!-- ë©”ë‰´ í˜ì´ì§€ -->
        <div id="menuPage">
            <!-- í—¤ë” -->
            <header class="bg-white shadow-md sticky top-0 z-50">
                <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-th-large text-3xl text-blue-600"></i>
                        <div>
                            <h1 class="text-xl font-bold text-gray-800">ë©”ë‰´</h1>
                            <p class="text-xs text-gray-600">ì›í•˜ëŠ” ë©”ë‰´ë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
                        </div>
                    </div>
                    <button onclick="logout()" 
                            class="text-red-500 hover:text-red-700 transition-colors px-3 py-2 rounded-lg hover:bg-red-50">
                        <i class="fas fa-sign-out-alt text-xl"></i>
                    </button>
                </div>
            </header>
            
            <!-- ë©”ë‰´ ì»¨í…ì¸  -->
            <main class="max-w-7xl mx-auto px-4 py-6 pb-20">
                <!-- ë©”ë‰´ ê·¸ë¦¬ë“œ -->
                <div class="grid grid-cols-2 gap-4" id="menuGrid">
                    <!-- ë©”ë‰´ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </main>
        </div>
    </div>
    
    <!-- í˜ì´ì§€ ì¸ë””ì¼€ì´í„° -->
    <div class="page-indicator">
        <div class="page-dot active" id="dot1"></div>
        <div class="page-dot" id="dot2"></div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="fixed top-20 left-1/2 transform -translate-x-1/2 z-[200] flex flex-col gap-3 pointer-events-none">
        <!-- Toasts will be added here -->
    </div>

    <!-- Confirm Modal -->
    <div id="confirmModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[300] flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full p-6 transform transition-all">
            <div class="flex items-center gap-3 mb-4">
                <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-exclamation-triangle text-yellow-600 text-xl"></i>
                </div>
                <h3 class="text-lg font-bold text-gray-800">í™•ì¸</h3>
            </div>
            <p id="confirmMessage" class="text-gray-600 mb-6"></p>
            <div class="flex gap-3">
                <button id="confirmCancel" class="flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition">
                    ì·¨ì†Œ
                </button>
                <button id="confirmOk" class="flex-1 px-4 py-3 bg-red-500 text-white rounded-lg font-medium hover:bg-red-600 transition">
                    í™•ì¸
                </button>
            </div>
        </div>
    </div>

    <script>
        // API Base URL
        // ë²„ì „ ì •ë³´
        const APP_VERSION = 'v2.0.98';
        console.log(`%cğŸš€ Dashboard ${APP_VERSION} ë¡œë“œë¨`, 'color: #10b981; font-weight: bold; font-size: 14px;');

        const API_BASE_URL = '';

        // API ìºì‹œ ë°©ì§€ ì„¤ì •
        axios.defaults.headers.common['Cache-Control'] = 'no-cache, no-store, must-revalidate';
        axios.defaults.headers.common['Pragma'] = 'no-cache';
        axios.defaults.headers.common['Expires'] = '0';

        let currentUser = null;
        let userType = null;
        let currentPage = 'dashboard'; // 'dashboard' or 'menu'
        
        // ìŠ¤ì™€ì´í”„ ê´€ë ¨ ë³€ìˆ˜
        let touchStartX = 0;
        let touchEndX = 0;
        let touchStartY = 0;
        let touchEndY = 0;
        
        // ì°¨íŠ¸ ê°ì²´
        let careerChart = null;
        let instructorChart = null;
        let counselingTrendChart = null;
        
        // Toast í•¨ìˆ˜
        function showToast(message, type = 'success', duration = 3000) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = 'transform transition-all duration-300 ease-in-out pointer-events-auto';
            
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            toast.innerHTML = `
                <div class="${colors[type]} text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3 min-w-[280px] max-w-[90vw]">
                    <i class="fas ${icons[type]} text-2xl"></i>
                    <span class="flex-1 font-medium">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-white hover:text-gray-200 ml-2">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(toast);
            
            // Entrance animation
            setTimeout(() => toast.style.transform = 'translateY(0)', 10);
            
            // Auto remove
            if (duration > 0) {
                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateY(-20px)';
                    setTimeout(() => toast.remove(), 300);
                }, duration);
            }
        }
        
        // Confirm í•¨ìˆ˜
        function showConfirm(message) {
            return new Promise((resolve) => {
                const modal = document.getElementById('confirmModal');
                const messageEl = document.getElementById('confirmMessage');
                const okBtn = document.getElementById('confirmOk');
                const cancelBtn = document.getElementById('confirmCancel');
                
                messageEl.textContent = message;
                modal.classList.remove('hidden');
                
                const handleOk = () => {
                    modal.classList.add('hidden');
                    okBtn.removeEventListener('click', handleOk);
                    cancelBtn.removeEventListener('click', handleCancel);
                    resolve(true);
                };
                
                const handleCancel = () => {
                    modal.classList.add('hidden');
                    okBtn.removeEventListener('click', handleOk);
                    cancelBtn.removeEventListener('click', handleCancel);
                    resolve(false);
                };
                
                okBtn.addEventListener('click', handleOk);
                cancelBtn.addEventListener('click', handleCancel);
                
                // ESC í‚¤ë¡œ ë‹«ê¸°
                const handleEsc = (e) => {
                    if (e.key === 'Escape') {
                        handleCancel();
                        document.removeEventListener('keydown', handleEsc);
                    }
                };
                document.addEventListener('keydown', handleEsc);
            });
        }
        
        // ë©”ë‰´ ì •ì˜ (ê¶Œí•œë³„)
        const MENUS = {
            // ê³µí†µ ë©”ë‰´
            common: [
                {
                    id: 'profile',
                    title: 'ë‚´ ì •ë³´',
                    icon: 'fa-user-circle',
                    color: 'from-blue-500 to-blue-600',
                    page: 'profile.html',
                    description: 'í”„ë¡œí•„ ê´€ë¦¬'
                },
                {
                    id: 'ssirn',
                    title: 'SSIRN',
                    icon: 'fa-book-open',
                    color: 'from-green-500 to-green-600',
                    page: 'ssirn.html',
                    description: 'ë©”ëª¨ ì‘ì„±Â·ì¡°íšŒ'
                },
                {
                    id: 'notices',
                    title: 'ê³µì§€ì‚¬í•­',
                    icon: 'fa-bullhorn',
                    color: 'from-purple-500 to-purple-600',
                    page: 'notices.html',
                    description: 'ê³µì§€ í™•ì¸'
                }
            ],
            
            // ê°•ì‚¬ ì „ìš© ë©”ë‰´
            instructor: [
                {
                    id: 'counseling',
                    title: 'ìƒë‹´ê´€ë¦¬',
                    icon: 'fa-comments',
                    color: 'from-orange-500 to-orange-600',
                    page: 'counseling.html',
                    description: 'í•™ìƒ ìƒë‹´'
                },
                {
                    id: 'training',
                    title: 'í›ˆë ¨ì¼ì§€',
                    icon: 'fa-clipboard-list',
                    color: 'from-indigo-500 to-indigo-600',
                    page: 'training.html',
                    description: 'ì¼ì§€ ê´€ë¦¬'
                },
                {
                    id: 'team',
                    title: 'íŒ€ í™œë™ì¼ì§€',
                    icon: 'fa-users',
                    color: 'from-pink-500 to-pink-600',
                    page: 'team.html',
                    description: 'íŒ€ í™œë™ ê¸°ë¡'
                }
            ],
            
            // í•™ìƒ ì „ìš© ë©”ë‰´ (í•™ìƒì€ common ë©”ë‰´ë§Œ ì‚¬ìš©)
            student: [
                // í•™ìƒì€ 'ë‚´ ì •ë³´', 'SSIRN', 'ê³µì§€ì‚¬í•­'ë§Œ í‘œì‹œ (common ë©”ë‰´)
            ]
        };
        
        // ë‚ ì§œ í¬ë§· í•¨ìˆ˜
        function formatDateWithDay(dateStr) {
            const date = new Date(dateStr);
            const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const dayOfWeek = days[date.getDay()];
            return `${month}ì›” ${day}ì¼ (${dayOfWeek})`;
        }
        
        // ìŠ¤ì™€ì´í”„ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        function initSwipe() {
            const container = document.getElementById('swipeContainer');
            
            document.addEventListener('touchstart', (e) => {
                touchStartX = e.changedTouches[0].screenX;
                touchStartY = e.changedTouches[0].screenY;
            }, { passive: true });
            
            document.addEventListener('touchend', (e) => {
                touchEndX = e.changedTouches[0].screenX;
                touchEndY = e.changedTouches[0].screenY;
                
                // ì„¸ë¡œ ìŠ¤í¬ë¡¤ì¸ì§€ ê°€ë¡œ ìŠ¤ì™€ì´í”„ì¸ì§€ íŒë‹¨
                const deltaX = Math.abs(touchEndX - touchStartX);
                const deltaY = Math.abs(touchEndY - touchStartY);
                
                // ê°€ë¡œ ì´ë™ì´ ì„¸ë¡œ ì´ë™ë³´ë‹¤ í¬ê³ , ìµœì†Œ ì´ë™ ê±°ë¦¬ë¥¼ ë§Œì¡±í•˜ë©´ ìŠ¤ì™€ì´í”„ë¡œ ì¸ì‹
                if (deltaX > deltaY && deltaX > 50) {
                    handleSwipe();
                }
            });
        }
        
        function handleSwipe() {
            const swipeDistance = touchEndX - touchStartX;
            
            if (swipeDistance > 50 && currentPage === 'menu') {
                // ìš°ì¸¡ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ â†’ ëŒ€ì‹œë³´ë“œë¡œ
                switchPage('dashboard');
            } else if (swipeDistance < -50 && currentPage === 'dashboard') {
                // ì¢Œì¸¡ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ â†’ ë©”ë‰´ë¡œ
                switchPage('menu');
                // íŒíŠ¸ ìˆ¨ê¸°ê¸°
                document.getElementById('swipeHint').style.display = 'none';
            }
        }
        
        function switchPage(page) {
            const container = document.getElementById('swipeContainer');
            const dot1 = document.getElementById('dot1');
            const dot2 = document.getElementById('dot2');
            
            if (page === 'menu') {
                container.classList.add('menu-active');
                dot1.classList.remove('active');
                dot2.classList.add('active');
                currentPage = 'menu';
                // ë©”ë‰´ë¡œ ì „í™˜ ì‹œ í˜ì´ì§€ë¥¼ ë§¨ ìœ„ë¡œ ìŠ¤í¬ë¡¤
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                container.classList.remove('menu-active');
                dot1.classList.add('active');
                dot2.classList.remove('active');
                currentPage = 'dashboard';
            }
        }
        
        // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ
        async function loadDashboardData() {
            try {
                console.log('ğŸš€ ëŒ€ì‹œë³´ë“œ ë¡œë”© ì‹œì‘...');
                
                // ëª¨ë“  ë°ì´í„°ë¥¼ ë³‘ë ¬ë¡œ ê°€ì ¸ì˜¤ê¸°
                const [
                    studentsData,
                    instructorsData,
                    coursesData,
                    counselingsData,
                    timetablesData,
                    projectsData,
                    trainingLogsData,
                    teamActivityLogsData,
                    noticesData
                ] = await Promise.all([
                    axios.get(`${API_BASE_URL}/api/students`).then(r => r.data),
                    axios.get(`${API_BASE_URL}/api/instructors`).then(r => r.data),
                    axios.get(`${API_BASE_URL}/api/courses`).then(r => r.data),
                    axios.get(`${API_BASE_URL}/api/counselings`).then(r => r.data),
                    axios.get(`${API_BASE_URL}/api/timetables`).then(r => r.data),
                    axios.get(`${API_BASE_URL}/api/projects`).then(r => r.data),
                    axios.get(`${API_BASE_URL}/api/training-logs`).then(r => r.data),
                    axios.get(`${API_BASE_URL}/api/team-activity-logs`).then(r => r.data),
                    axios.get(`${API_BASE_URL}/api/notices`).then(r => r.data)
                ]);
                
                console.log('âœ… ë°ì´í„° ë¡œë”© ì™„ë£Œ:', {
                    students: studentsData.length,
                    instructors: instructorsData.length,
                    courses: coursesData.length,
                    counselings: counselingsData.length,
                    notices: noticesData.length
                });
                
                // ì˜¤ëŠ˜ ë‚ ì§œ (ë¡œì»¬ ì‹œê°„ëŒ€ ì‚¬ìš©)
                const now = new Date();
                const today = now.getFullYear() + '-' + 
                              String(now.getMonth() + 1).padStart(2, '0') + '-' + 
                              String(now.getDate()).padStart(2, '0');
                

                
                // ìµœê·¼ í›ˆë ¨ì¼ì§€ (ìµœê·¼ 5ê±´)
                const recentTrainingLogs = trainingLogsData
                    .sort((a, b) => {
                        const dateA = new Date(a['t.class_date'] || a.class_date || 0);
                        const dateB = new Date(b['t.class_date'] || b.class_date || 0);
                        return dateB - dateA;
                    })
                    .slice(0, 5);
                
                // ìµœê·¼ íŒ€ í™œë™ì¼ì§€ (ìµœê·¼ 5ê±´)
                const recentTeamActivityLogs = teamActivityLogsData
                    .sort((a, b) => new Date(b.activity_date) - new Date(a.activity_date))
                    .slice(0, 5)
                    .map(log => {
                        const project = projectsData.find(p => p.id === log.project_id);
                        const instructor = instructorsData.find(i => i.code === log.instructor_code);
                        return {
                            ...log,
                            project_name: project?.name || 'í”„ë¡œì íŠ¸ëª… ì—†ìŒ',
                            project_code: project?.code || '',
                            instructor_name: instructor?.name || 'ê°•ì‚¬ëª… ì—†ìŒ'
                        };
                    });
                
                // í™œì„± ê³µì§€ì‚¬í•­ (ê²Œì‹œ ê¸°ê°„ ë‚´)
                const activeNotices = noticesData
                    .filter(n => {
                        const startDate = n.start_date ? new Date(n.start_date) : null;
                        const endDate = n.end_date ? new Date(n.end_date) : null;
                        
                        if (!startDate && !endDate) return true;
                        if (!startDate) return now <= endDate;
                        if (!endDate) return now >= startDate;
                        return now >= startDate && now <= endDate;
                    })
                    .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
                    .slice(0, 5);
                
                console.log('ğŸ“¢ ëŒ€ì‹œë³´ë“œ ê³µì§€ì‚¬í•­:', {
                    ì „ì²´: noticesData.length,
                    í™œì„±: activeNotices.length
                });
                
                // ì¶”ê°€ í†µê³„ ê³„ì‚°
                const todayCounselings = counselingsData.filter(c => {
                    const consultDate = c.consultation_date ? c.consultation_date.split('T')[0].split(' ')[0] : '';
                    return consultDate === today;
                }).length;
                
                const thisWeekStart = new Date();
                thisWeekStart.setDate(thisWeekStart.getDate() - thisWeekStart.getDay());
                const thisWeekStartStr = thisWeekStart.getFullYear() + '-' + 
                                         String(thisWeekStart.getMonth() + 1).padStart(2, '0') + '-' + 
                                         String(thisWeekStart.getDate()).padStart(2, '0');
                const thisWeekCounselings = counselingsData.filter(c => {
                    const consultDate = c.consultation_date ? c.consultation_date.split('T')[0].split(' ')[0] : '';
                    return consultDate >= thisWeekStartStr;
                }).length;
                
                // ìµœê·¼ 7ì¼ ìƒë‹´ ì¶”ì´
                const last7Days = [];
                for (let i = 6; i >= 0; i--) {
                    const d = new Date();
                    d.setDate(d.getDate() - i);
                    const dateStr = d.getFullYear() + '-' + 
                                    String(d.getMonth() + 1).padStart(2, '0') + '-' + 
                                    String(d.getDate()).padStart(2, '0');
                    last7Days.push({
                        date: dateStr,
                        count: counselingsData.filter(c => {
                            const consultDate = c.consultation_date ? c.consultation_date.split('T')[0].split(' ')[0] : '';
                            return consultDate === dateStr;
                        }).length
                    });
                }
                
                // ì§„ë¡œ ê²°ì • í˜„í™© ê³„ì‚°
                const careerCounts = { study: 0, employed: 0, startup: 0, undecided: 0, other: 0 };
                
                studentsData.forEach(student => {
                    const studentCounselings = counselingsData.filter(c => c.student_id === student.id);
                    
                    if (studentCounselings.length > 0) {
                        studentCounselings.sort((a, b) => new Date(b.consultation_date) - new Date(a.consultation_date));
                        const lastCounseling = studentCounselings[0];
                        
                        if (lastCounseling.career_decision) {
                            if (lastCounseling.career_decision === '1. í•™ì—…') careerCounts.study++;
                            else if (lastCounseling.career_decision === '2. ì·¨ì—…') careerCounts.employed++;
                            else if (lastCounseling.career_decision === '3. ì°½ì—…') careerCounts.startup++;
                            else if (lastCounseling.career_decision === '4. ë¯¸ì •') careerCounts.undecided++;
                            else if (lastCounseling.career_decision === '5. ê¸°íƒ€') careerCounts.other++;
                        } else {
                            careerCounts.undecided++;
                        }
                    } else {
                        careerCounts.undecided++;
                    }
                });
                
                // ê°•ì‚¬ ìœ í˜•ë³„ í†µê³„
                const instructorsByType = {};
                instructorsData.forEach(i => {
                    const typeName = i.instructor_type_name || 'ë¯¸ë¶„ë¥˜';
                    instructorsByType[typeName] = (instructorsByType[typeName] || 0) + 1;
                });
                
                // ê¸°ë³¸ ê³¼ì • (localStorageì—ì„œ ë³µì› ë˜ëŠ” 'ì „ì²´', ì—†ìœ¼ë©´ C-001 ë˜ëŠ” ì²« ë²ˆì§¸)
                const savedCourseCode = localStorage.getItem('mobile_dashboard_selected_course');
                let mainCourse;
                let isAllCourses = false;
                
                if (savedCourseCode === 'ALL') {
                    isAllCourses = true;
                    mainCourse = { code: 'ALL', name: 'ì „ì²´ ê³¼ì •' };
                } else {
                    mainCourse = (savedCourseCode ? coursesData.find(c => c.code === savedCourseCode) : null) 
                                || coursesData.find(c => c.code === 'C-001') 
                                || coursesData[0];
                }
                
                // ì„ íƒëœ ê³¼ì •ì˜ í•™ìƒë“¤ (ì „ì²´ ê³¼ì •ì´ë©´ ëª¨ë“  í•™ìƒ)
                const courseStudents = isAllCourses ? studentsData : studentsData.filter(s => s.course_code === mainCourse.code);
                const courseStudentIds = courseStudents.map(s => s.id);
                
                // ì˜¤ëŠ˜ ì‹œê°„í‘œ (ì „ì²´ ê³¼ì •ì´ë©´ ëª¨ë“  ì‹œê°„í‘œ, ì•„ë‹ˆë©´ ì„ íƒëœ ê³¼ì •ë§Œ)
                const todayTimetables = isAllCourses 
                    ? timetablesData.filter(t => t.class_date === today)
                    : timetablesData.filter(t => t.class_date === today && t.course_code === mainCourse.code);
                
                // ìµœê·¼ ìƒë‹´ (ì „ì²´ ê³¼ì •ì´ë©´ ëª¨ë“  ìƒë‹´, ì•„ë‹ˆë©´ ì„ íƒëœ ê³¼ì • í•™ìƒë§Œ, ìµœê·¼ 5ê±´)
                const recentCounselings = counselingsData
                    .filter(c => isAllCourses || courseStudentIds.includes(c.student_id))
                    .sort((a, b) => new Date(b.consultation_date) - new Date(a.consultation_date))
                    .slice(0, 5);
                
                // ëŒ€ì‹œë³´ë“œ ë Œë”ë§
                renderDashboard({
                    studentsData,
                    instructorsData,
                    coursesData,
                    counselingsData,
                    timetablesData,
                    projectsData,
                    trainingLogsData,
                    teamActivityLogsData,
                    noticesData,
                    todayTimetables,
                    recentCounselings,
                    recentTrainingLogs,
                    recentTeamActivityLogs,
                    activeNotices,
                    todayCounselings,
                    thisWeekCounselings,
                    last7Days,
                    careerCounts,
                    instructorsByType,
                    mainCourse,
                    today,
                    isAllCourses,
                    courseStudents
                });
                
            } catch (error) {
                console.error('Failed to load dashboard data:', error);
                document.getElementById('dashboardContent').innerHTML = `
                    <div class="text-center py-8 text-red-500">
                        <i class="fas fa-exclamation-triangle text-4xl mb-3"></i>
                        <p>ë°ì´í„° ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</p>
                        <button onclick="loadDashboardData()" class="mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg">
                            ë‹¤ì‹œ ì‹œë„
                        </button>
                    </div>
                `;
            }
        }
        
        // ëŒ€ì‹œë³´ë“œ ë Œë”ë§
        function renderDashboard(data) {
            const {
                studentsData,
                instructorsData,
                coursesData,
                counselingsData,
                projectsData,
                todayTimetables,
                recentCounselings,
                recentTrainingLogs,
                recentTeamActivityLogs,
                activeNotices,
                todayCounselings,
                thisWeekCounselings,
                last7Days,
                careerCounts,
                instructorsByType,
                mainCourse,
                today,
                isAllCourses,
                courseStudents
            } = data;
            
            const container = document.getElementById('dashboardContent');
            container.innerHTML = `
                <!-- ê³¼ì • ì„ íƒ ë“œë¡­ë‹¤ìš´ -->
                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-filter mr-1 text-blue-600"></i>ê³¼ì • ì„ íƒ
                    </label>
                    <select id="mobile-course-filter" 
                            class="w-full px-4 py-3 border-2 border-blue-500 rounded-lg text-base font-semibold bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-600" 
                            onchange="window.filterMobileDashboard(this.value)">
                        <option value="ALL" ${mainCourse.code === 'ALL' ? 'selected' : ''}>
                            ğŸŒ ì „ì²´ ê³¼ì •
                        </option>
                        ${coursesData.map(c => `
                            <option value="${c.code}" ${c.code === mainCourse.code ? 'selected' : ''}>
                                ${c.name || c.code}
                            </option>
                        `).join('')}
                    </select>
                </div>
                
                <!-- ìƒë‹¨ ë‚ ì§œ ì •ë³´ -->
                <div class="flex justify-between items-center mb-4">
                    <div class="text-sm text-gray-600">
                        <i class="fas fa-calendar-day mr-1"></i>${formatDateWithDay(today)}
                    </div>
                </div>
                
                ${userType === 'instructor' ? `
                <!-- ìƒë‹¨ í†µê³„ ì¹´ë“œ (6ê°œ) - ê°•ì‚¬ ì „ìš© -->
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <!-- í•™ìƒ -->
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg p-4 text-white">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-user-graduate text-2xl"></i>
                            <p class="text-3xl font-bold">${courseStudents.length}</p>
                        </div>
                        <p class="text-xs text-blue-100">${isAllCourses ? 'ì „ì²´' : 'ê³¼ì •'} í•™ìƒ</p>
                    </div>
                    
                    <!-- ê°•ì‚¬ -->
                    <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl shadow-lg p-4 text-white">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-chalkboard-teacher text-2xl"></i>
                            <p class="text-3xl font-bold">${instructorsData.length}</p>
                        </div>
                        <p class="text-xs text-green-100">ì „ì²´ ê°•ì‚¬</p>
                    </div>
                    
                    <!-- ê³¼ì • -->
                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl shadow-lg p-4 text-white">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-school text-2xl"></i>
                            <p class="text-3xl font-bold">${coursesData.length}</p>
                        </div>
                        <p class="text-xs text-purple-100">ìš´ì˜ ê³¼ì •</p>
                    </div>
                    
                    <!-- ì˜¤ëŠ˜ ìˆ˜ì—… -->
                    <div class="bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-xl shadow-lg p-4 text-white">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-calendar-day text-2xl"></i>
                            <p class="text-3xl font-bold">${todayTimetables.length}</p>
                        </div>
                        <p class="text-xs text-indigo-100">ì˜¤ëŠ˜ ìˆ˜ì—…</p>
                    </div>
                    
                    <!-- ìƒë‹´ -->
                    <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl shadow-lg p-4 text-white">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-comments text-2xl"></i>
                            <p class="text-3xl font-bold">${todayCounselings}</p>
                        </div>
                        <p class="text-xs text-orange-100">ì˜¤ëŠ˜ ìƒë‹´ (ì´ ${counselingsData.length})</p>
                    </div>
                    
                    <!-- íŒ€ -->
                    <div class="bg-gradient-to-br from-pink-500 to-pink-600 rounded-xl shadow-lg p-4 text-white">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-users text-2xl"></i>
                            <p class="text-3xl font-bold">${projectsData.length}</p>
                        </div>
                        <p class="text-xs text-pink-100">í™œë™íŒ€</p>
                    </div>
                </div>
                ` : `
                <!-- ìƒë‹¨ í†µê³„ ì¹´ë“œ (2ê°œ) - í•™ìƒ ì „ìš© -->
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <!-- ì˜¤ëŠ˜ ìˆ˜ì—… -->
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg p-4 text-white">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-calendar-day text-2xl"></i>
                            <p class="text-3xl font-bold">${todayTimetables.length}</p>
                        </div>
                        <p class="text-xs text-blue-100">ì˜¤ëŠ˜ ìˆ˜ì—…</p>
                    </div>
                    
                    <!-- ê³µì§€ì‚¬í•­ -->
                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl shadow-lg p-4 text-white">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-bullhorn text-2xl"></i>
                            <p class="text-3xl font-bold">${activeNotices.length}</p>
                        </div>
                        <p class="text-xs text-purple-100">í™œì„± ê³µì§€ì‚¬í•­</p>
                    </div>
                </div>
                `}
                
                ${userType === 'instructor' ? `
                <!-- ì°¨íŠ¸ ì„¹ì…˜ (3ê°œ ì°¨íŠ¸) - ê°•ì‚¬ ì „ìš© -->
                <div class="grid grid-cols-1 gap-4 mb-4">
                    <!-- ì§„ë¡œ ê²°ì • í˜„í™© -->
                    <div class="bg-white rounded-xl shadow-lg p-4 fade-in">
                        <h3 class="text-sm font-bold text-gray-800 mb-3 flex items-center">
                            <i class="fas fa-chart-pie mr-2 text-blue-600"></i>ì§„ë¡œ ê²°ì • í˜„í™©
                        </h3>
                        <canvas id="careerChart" style="max-height: 200px;"></canvas>
                        <div class="mt-3 grid grid-cols-5 gap-2 text-xs">
                            <div class="text-center">
                                <div class="w-3 h-3 bg-blue-500 rounded-full mx-auto mb-1"></div>
                                <p class="font-bold text-blue-600">${careerCounts.study}</p>
                                <p class="text-gray-600">í•™ì—…</p>
                            </div>
                            <div class="text-center">
                                <div class="w-3 h-3 bg-green-500 rounded-full mx-auto mb-1"></div>
                                <p class="font-bold text-green-600">${careerCounts.employed}</p>
                                <p class="text-gray-600">ì·¨ì—…</p>
                            </div>
                            <div class="text-center">
                                <div class="w-3 h-3 bg-yellow-500 rounded-full mx-auto mb-1"></div>
                                <p class="font-bold text-yellow-600">${careerCounts.startup}</p>
                                <p class="text-gray-600">ì°½ì—…</p>
                            </div>
                            <div class="text-center">
                                <div class="w-3 h-3 bg-gray-400 rounded-full mx-auto mb-1"></div>
                                <p class="font-bold text-gray-600">${careerCounts.undecided}</p>
                                <p class="text-gray-600">ë¯¸ì •</p>
                            </div>
                            <div class="text-center">
                                <div class="w-3 h-3 bg-purple-500 rounded-full mx-auto mb-1"></div>
                                <p class="font-bold text-purple-600">${careerCounts.other}</p>
                                <p class="text-gray-600">ê¸°íƒ€</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ê°•ì‚¬ ìœ í˜•ë³„ ë¶„í¬ -->
                    <div class="bg-white rounded-xl shadow-lg p-4 fade-in" style="animation-delay: 0.1s">
                        <h3 class="text-sm font-bold text-gray-800 mb-3 flex items-center">
                            <i class="fas fa-user-tie mr-2 text-green-600"></i>ê°•ì‚¬ ìœ í˜•ë³„ ë¶„í¬
                        </h3>
                        <canvas id="instructorChart" style="max-height: 200px;"></canvas>
                        <div class="mt-3 text-xs text-gray-600">
                            ${Object.entries(instructorsByType).map(([type, count], idx) => `
                                <div class="flex items-center justify-between py-1">
                                    <span class="flex items-center">
                                        <span class="w-3 h-3 rounded-full mr-2" style="background-color: ${['#3B82F6', '#10B981', '#F59E0B', '#8B5CF6'][idx % 4]}"></span>
                                        ${type}
                                    </span>
                                    <span class="font-semibold">${count}ëª…</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- ìµœê·¼ 7ì¼ ìƒë‹´ ì¶”ì´ -->
                    <div class="bg-white rounded-xl shadow-lg p-4 fade-in" style="animation-delay: 0.2s">
                        <h3 class="text-sm font-bold text-gray-800 mb-3 flex items-center">
                            <i class="fas fa-chart-line mr-2 text-orange-600"></i>ìµœê·¼ 7ì¼ ìƒë‹´ ì¶”ì´
                        </h3>
                        <canvas id="counselingTrendChart" style="max-height: 200px;"></canvas>
                        <div class="mt-3 flex justify-between text-xs text-gray-600">
                            <div>
                                <span class="text-gray-500">ì˜¤ëŠ˜:</span>
                                <span class="font-bold text-orange-600">${todayCounselings}ê±´</span>
                            </div>
                            <div>
                                <span class="text-gray-500">ì´ë²ˆ ì£¼:</span>
                                <span class="font-bold text-blue-600">${thisWeekCounselings}ê±´</span>
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}
                
                <!-- ì˜¤ëŠ˜ ì‹œê°„í‘œ -->
                <div class="bg-white rounded-xl shadow-lg p-4 mb-4 fade-in" style="animation-delay: 0.3s">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-sm font-bold text-gray-800">
                            <i class="fas fa-calendar-day mr-2 text-blue-600"></i>ì˜¤ëŠ˜ ì‹œê°„í‘œ
                        </h3>
                    </div>
                    <div class="space-y-2">
                        ${todayTimetables.length > 0 ? todayTimetables.slice(0, 5).map(t => `
                            <div class="border-l-4 ${
                                t.type === 'lecture' ? 'border-blue-500' : 
                                t.type === 'project' ? 'border-green-500' : 
                                'border-purple-500'
                            } bg-gray-50 rounded p-3">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center gap-2 mb-1">
                                            <h4 class="font-bold text-gray-800 text-sm truncate">${t.subject_name || 'ê³¼ëª©ëª… ì—†ìŒ'}</h4>
                                            <span class="text-xs px-2 py-0.5 rounded flex-shrink-0 ${
                                                t.type === 'lecture' ? 'bg-blue-100 text-blue-700' : 
                                                t.type === 'project' ? 'bg-green-100 text-green-700' : 
                                                'bg-purple-100 text-purple-700'
                                            }">
                                                ${t.type === 'lecture' ? 'ê°•ì˜' : t.type === 'project' ? 'í”„ë¡œì íŠ¸' : 'ì‹¤ìŠµ'}
                                            </span>
                                        </div>
                                        <p class="text-xs text-gray-600 truncate">
                                            <i class="fas fa-chalkboard-teacher mr-1"></i>${t.instructor_name || 'ë¯¸ì •'}
                                        </p>
                                    </div>
                                    <div class="text-right ml-2 flex-shrink-0">
                                        <p class="text-xs font-bold text-blue-600">${t.start_time.substring(0,5)}</p>
                                        <p class="text-xs text-gray-500">${t.end_time.substring(0,5)}</p>
                                    </div>
                                </div>
                            </div>
                        `).join('') : '<p class="text-center py-8 text-gray-500">ì˜¤ëŠ˜ ì˜ˆì •ëœ ìˆ˜ì—…ì´ ì—†ìŠµë‹ˆë‹¤</p>'}
                    </div>
                </div>
                
                ${userType === 'instructor' ? `
                <!-- ìµœê·¼ ìƒë‹´ (ê°•ì‚¬ ì „ìš©) -->
                <div class="bg-white rounded-xl shadow-lg p-4 mb-4 fade-in" style="animation-delay: 0.4s">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-sm font-bold text-gray-800">
                            <i class="fas fa-comments mr-2 text-orange-600"></i>ìµœê·¼ ìƒë‹´
                        </h3>
                    </div>
                    <div class="space-y-2">
                        ${recentCounselings.length > 0 ? recentCounselings.map(c => `
                            <div class="bg-orange-50 rounded-lg p-3">
                                <div class="flex justify-between items-start mb-1">
                                    <p class="text-sm font-bold text-gray-800">${c.student_name || 'í•™ìƒëª… ì—†ìŒ'}</p>
                                    <span class="text-xs px-2 py-1 rounded-full ${
                                        c.status === 'ì˜ˆì•½' ? 'bg-orange-200 text-orange-800' :
                                        c.status === 'ì™„ë£Œ' ? 'bg-green-200 text-green-800' :
                                        'bg-gray-200 text-gray-800'
                                    }">${c.status || 'ë¯¸ì •'}</span>
                                </div>
                                <p class="text-xs text-gray-600 mb-1">
                                    <i class="fas fa-chalkboard-teacher mr-1"></i>${c.instructor_name || 'ê°•ì‚¬ëª… ì—†ìŒ'}
                                </p>
                                <p class="text-xs text-gray-600 mb-2">${c.content?.substring(0, 50) || 'ë‚´ìš© ì—†ìŒ'}...</p>
                                <div class="flex items-center gap-2 text-xs text-gray-500">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>${new Date(c.consultation_date).toLocaleDateString('ko-KR')}</span>
                                </div>
                            </div>
                        `).join('') : '<p class="text-center py-8 text-gray-500">ìµœê·¼ ìƒë‹´ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</p>'}
                    </div>
                </div>
                
                <!-- ìµœê·¼ í›ˆë ¨ì¼ì§€ (ê°•ì‚¬ ì „ìš©) -->
                <div class="bg-white rounded-xl shadow-lg p-4 mb-4 fade-in" style="animation-delay: 0.5s">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-sm font-bold text-gray-800">
                            <i class="fas fa-clipboard-list mr-2 text-indigo-600"></i>ìµœê·¼ í›ˆë ¨ì¼ì§€
                        </h3>
                    </div>
                    <div class="space-y-2">
                        ${recentTrainingLogs.length > 0 ? recentTrainingLogs.map(t => `
                            <div class="bg-indigo-50 rounded-lg p-3">
                                <div class="flex justify-between items-start mb-1">
                                    <p class="text-sm font-bold text-gray-800">${t.subject_name || 'ê³¼ëª©ëª… ì—†ìŒ'}</p>
                                    <span class="text-xs px-2 py-1 rounded-full ${
                                        t.type === 'lecture' ? 'bg-blue-100 text-blue-700' : 
                                        t.type === 'project' ? 'bg-green-100 text-green-700' : 
                                        'bg-purple-100 text-purple-700'
                                    }">
                                        ${t.type === 'lecture' ? 'ê°•ì˜' : t.type === 'project' ? 'í”„ë¡œì íŠ¸' : 'ì‹¤ìŠµ'}
                                    </span>
                                </div>
                                <p class="text-xs text-gray-600 mb-2">
                                    <i class="fas fa-chalkboard-teacher mr-1"></i>${t.instructor_name || 'ê°•ì‚¬ëª… ì—†ìŒ'}
                                </p>
                                <p class="text-xs text-gray-600 mb-2">${t.content?.substring(0, 50) || 'ë‚´ìš© ì—†ìŒ'}...</p>
                                <div class="flex items-center gap-2 text-xs text-gray-500">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>${new Date(t['t.class_date'] || t.class_date).toLocaleDateString('ko-KR')}</span>
                                </div>
                            </div>
                        `).join('') : '<p class="text-center py-8 text-gray-500">ìµœê·¼ í›ˆë ¨ì¼ì§€ê°€ ì—†ìŠµë‹ˆë‹¤</p>'}
                    </div>
                </div>
                
                <!-- ìµœê·¼ íŒ€ í™œë™ì¼ì§€ (ê°•ì‚¬ ì „ìš©) -->
                <div class="bg-white rounded-xl shadow-lg p-4 mb-4 fade-in" style="animation-delay: 0.6s">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-sm font-bold text-gray-800">
                            <i class="fas fa-users mr-2 text-pink-600"></i>ìµœê·¼ íŒ€ í™œë™ì¼ì§€
                        </h3>
                    </div>
                    <div class="space-y-2">
                        ${recentTeamActivityLogs.length > 0 ? recentTeamActivityLogs.map(t => `
                            <div class="bg-pink-50 rounded-lg p-3">
                                <div class="flex justify-between items-start mb-1">
                                    <p class="text-sm font-bold text-gray-800">${t.project_name}</p>
                                    <span class="text-xs text-gray-500">${t.activity_type || 'ìœ í˜• ì—†ìŒ'}</span>
                                </div>
                                <p class="text-xs text-gray-600 mb-1">
                                    <i class="fas fa-chalkboard-teacher mr-1"></i>${t.instructor_name || 'ê°•ì‚¬ëª… ì—†ìŒ'}
                                </p>
                                <p class="text-xs text-gray-600 mb-2">${t.content?.substring(0, 50) || 'ë‚´ìš© ì—†ìŒ'}...</p>
                                <div class="flex items-center gap-2 text-xs text-gray-500">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>${new Date(t.activity_date).toLocaleDateString('ko-KR')}</span>
                                </div>
                            </div>
                        `).join('') : '<p class="text-center py-8 text-gray-500">ìµœê·¼ íŒ€ í™œë™ì¼ì§€ê°€ ì—†ìŠµë‹ˆë‹¤</p>'}
                    </div>
                </div>
                ` : ''}
                
                <!-- í™œì„± ê³µì§€ì‚¬í•­ -->
                <div class="bg-white rounded-xl shadow-lg p-4 mb-4 fade-in" style="animation-delay: 0.7s">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-sm font-bold text-gray-800">
                            <i class="fas fa-bullhorn mr-2 text-purple-600"></i>ê³µì§€ì‚¬í•­
                        </h3>
                        <button onclick="navigateToPage('notices.html')" class="text-blue-600 text-xs font-semibold">
                            ì „ì²´ <i class="fas fa-arrow-right ml-1"></i>
                        </button>
                    </div>
                    <div class="space-y-2">
                        ${activeNotices.length > 0 ? activeNotices.map(n => {
                            const categoryColors = {
                                'ì¼ë°˜': 'bg-blue-100 text-blue-700',
                                'ê¸´ê¸‰': 'bg-red-100 text-red-700',
                                'ì¤‘ìš”': 'bg-yellow-100 text-yellow-700'
                            };
                            const isNew = (new Date() - new Date(n.created_at)) < 24 * 60 * 60 * 1000;
                            return `
                            <div class="bg-purple-50 rounded-lg p-3" onclick="navigateToPage('notices.html')">
                                <div class="flex items-start justify-between mb-1">
                                    <div class="flex items-center gap-2">
                                        <span class="px-2 py-1 rounded-full text-xs font-semibold ${categoryColors[n.category] || categoryColors['ì¼ë°˜']}">
                                            ${n.category}
                                        </span>
                                        ${isNew ? '<span class="px-2 py-1 bg-red-500 text-white rounded-full text-xs font-bold">NEW</span>' : ''}
                                    </div>
                                </div>
                                <p class="text-sm font-bold text-gray-800 mb-1">${n.title}</p>
                                <div class="flex items-center gap-2 text-xs text-gray-500">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>${new Date(n.created_at).toLocaleDateString('ko-KR')}</span>
                                </div>
                            </div>
                        `}).join('') : '<p class="text-center py-8 text-gray-500">í™œì„± ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤</p>'}
                    </div>
                </div>
            `;
            
            // ì°¨íŠ¸ ë Œë”ë§
            setTimeout(() => {
                renderCareerChart(careerCounts);
                renderInstructorChart(instructorsByType);
                renderCounselingTrendChart(last7Days);
            }, 100);
        }
        
        // ì§„ë¡œ ê²°ì • ì°¨íŠ¸ ë Œë”ë§
        function renderCareerChart(careerCounts) {
            const ctx = document.getElementById('careerChart');
            if (!ctx) return;
            
            if (careerChart) careerChart.destroy();
            
            careerChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['í•™ì—…', 'ì·¨ì—…', 'ì°½ì—…', 'ë¯¸ì •', 'ê¸°íƒ€'],
                    datasets: [{
                        data: [
                            careerCounts.study,
                            careerCounts.employed,
                            careerCounts.startup,
                            careerCounts.undecided,
                            careerCounts.other
                        ],
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(234, 179, 8, 0.8)',
                            'rgba(156, 163, 175, 0.8)',
                            'rgba(168, 85, 247, 0.8)'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        // ê°•ì‚¬ ìœ í˜• ì°¨íŠ¸ ë Œë”ë§
        function renderInstructorChart(instructorsByType) {
            const ctx = document.getElementById('instructorChart');
            if (!ctx) return;
            
            if (instructorChart) instructorChart.destroy();
            
            const labels = Object.keys(instructorsByType);
            const data = Object.values(instructorsByType);
            const colors = ['#3B82F6', '#10B981', '#F59E0B', '#8B5CF6', '#EC4899', '#06B6D4'];
            
            instructorChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        // ìƒë‹´ ì¶”ì´ ì°¨íŠ¸ ë Œë”ë§
        function renderCounselingTrendChart(last7Days) {
            const ctx = document.getElementById('counselingTrendChart');
            if (!ctx) return;
            
            if (counselingTrendChart) counselingTrendChart.destroy();
            
            const labels = last7Days.map(d => {
                const date = new Date(d.date);
                return `${date.getMonth() + 1}/${date.getDate()}`;
            });
            const data = last7Days.map(d => d.count);
            
            counselingTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ìƒë‹´ ê±´ìˆ˜',
                        data: data,
                        borderColor: 'rgb(249, 115, 22)',
                        backgroundColor: 'rgba(249, 115, 22, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }
        
        // ëª¨ë°”ì¼ ëŒ€ì‹œë³´ë“œ ê³¼ì • í•„í„°
        window.filterMobileDashboard = function(courseCode) {
            // ì„ íƒëœ ê³¼ì • ì½”ë“œë¥¼ localStorageì— ì €ì¥
            localStorage.setItem('mobile_dashboard_selected_course', courseCode);
            // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
            loadDashboardData();
        };
        
        // í˜ì´ì§€ ì´ˆê¸°í™”
        async function initializePage() {
            const user = JSON.parse(sessionStorage.getItem('user'));
            const type = sessionStorage.getItem('user_type');
            
            // ë¡œê·¸ì¸ ì²´í¬
            if (!user || !type) {
                window.location.href = 'login.html';
                return;
            }
            
            currentUser = user;
            userType = type;
            
            // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
            const userName = user.name || 'ì‚¬ìš©ì';
            let userRole = '';
            
            if (userType === 'instructor') {
                // ê°•ì‚¬ì¼ ê²½ìš°: ì´ë¦„(ì—­í• , ì „ê³µê³¼ëª©)
                const instructorTypeName = user.instructor_type_name || 'ê°•ì‚¬';
                const major = user.major || '';
                userRole = major ? `${instructorTypeName}, ${major}` : instructorTypeName;
            } else {
                userRole = 'í•™ìƒ';
            }
            
            document.getElementById('userInfo').textContent = `${userName} (${userRole})`;
            
            // í•™ìƒ/ê°•ì‚¬ ëª¨ë‘ ë©”ë‰´ ìƒì„±
            renderMenus(userType);
            
            // í•™ìƒì€ ë©”ë‰´ë§Œ í‘œì‹œ (ëŒ€ì‹œë³´ë“œ ë¶ˆí•„ìš”)
            if (userType === 'student') {
                // í•™ìƒìš©: ëŒ€ì‹œë³´ë“œ ì™„ì „íˆ ì œê±°í•˜ê³  ë©”ë‰´ë§Œ í‘œì‹œ
                const swipeContainer = document.getElementById('swipeContainer');
                const dashboardPage = document.getElementById('dashboardPage');
                const menuPage = document.getElementById('menuPage');
                const pageIndicator = document.querySelector('.page-indicator');
                
                console.log('ğŸ¯ í•™ìƒ ëª¨ë“œ ì´ˆê¸°í™” ì‹œì‘...');
                console.log('- swipeContainer:', swipeContainer);
                console.log('- dashboardPage:', dashboardPage);
                console.log('- menuPage:', menuPage);
                
                // ëŒ€ì‹œë³´ë“œ ì œê±°
                if (dashboardPage) {
                    dashboardPage.remove();
                    console.log('âœ… ëŒ€ì‹œë³´ë“œ ì œê±° ì™„ë£Œ');
                }
                
                // ë©”ë‰´ í˜ì´ì§€ë¥¼ 100% ë„ˆë¹„ë¡œ ì„¤ì • (important ì‚¬ìš©)
                if (menuPage) {
                    menuPage.style.cssText = 'width: 100% !important; min-height: 100vh;';
                    console.log('âœ… ë©”ë‰´ í˜ì´ì§€ ë„ˆë¹„ 100% ì„¤ì •');
                }
                
                // ìŠ¤ì™€ì´í”„ ì»¨í…Œì´ë„ˆë¥¼ ì •ì  ë ˆì´ì•„ì›ƒìœ¼ë¡œ ë³€ê²½ (important ì‚¬ìš©)
                if (swipeContainer) {
                    swipeContainer.style.cssText = 'width: 100% !important; display: block !important; transform: none !important;';
                    console.log('âœ… ìŠ¤ì™€ì´í”„ ì»¨í…Œì´ë„ˆ ì •ì  ë ˆì´ì•„ì›ƒ ì„¤ì •');
                }
                
                // í˜ì´ì§€ ì¸ë””ì¼€ì´í„° ìˆ¨ê¹€
                if (pageIndicator) {
                    pageIndicator.style.display = 'none';
                    console.log('âœ… í˜ì´ì§€ ì¸ë””ì¼€ì´í„° ìˆ¨ê¹€');
                }
                
                console.log('âœ… í•™ìƒ ëª¨ë“œ ì´ˆê¸°í™” ì™„ë£Œ!');
            } else {
                // ê°•ì‚¬ëŠ” ìŠ¤ì™€ì´í”„ ì´ˆê¸°í™” ë° ëŒ€ì‹œë³´ë“œ ë¡œë“œ
                console.log('ğŸ‘¨â€ğŸ« ê°•ì‚¬ ëª¨ë“œ - ëŒ€ì‹œë³´ë“œ ë¡œë“œ');
                initSwipe();
                await loadDashboardData();
            }
        }
        
        // ë©”ë‰´ ë Œë”ë§
        function renderMenus(userType) {
            const menuGrid = document.getElementById('menuGrid');
            
            // ê³µí†µ ë©”ë‰´ + ê¶Œí•œë³„ ë©”ë‰´
            const menus = [
                ...MENUS.common,
                ...(userType === 'instructor' ? MENUS.instructor : MENUS.student)
            ];
            
            console.log(`ğŸ“‹ ë©”ë‰´ ë Œë”ë§ - ì‚¬ìš©ì íƒ€ì…: ${userType}, ë©”ë‰´ ê°œìˆ˜: ${menus.length}`, menus);
            
            if (!menuGrid) {
                console.error('âŒ menuGrid ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }
            
            menuGrid.innerHTML = menus.map((menu, index) => `
                <div class="menu-card bg-white rounded-2xl shadow-lg overflow-hidden cursor-pointer fade-in active:scale-95 active:shadow-xl transition-all"
                     style="animation-delay: ${index * 0.1}s"
                     onclick="navigateToPageFromMenu('${menu.page}')">
                    <div class="bg-gradient-to-br ${menu.color} p-6 text-white">
                        <i class="fas ${menu.icon} text-5xl mb-3"></i>
                        <h3 class="text-xl font-bold">${menu.title}</h3>
                    </div>
                    <div class="p-4">
                        <p class="text-sm text-gray-600">${menu.description}</p>
                    </div>
                </div>
            `).join('');
        }
        
        // í˜ì´ì§€ ì´ë™ (ëŒ€ì‹œë³´ë“œì—ì„œ)
        function navigateToPage(page) {
            // History state ì €ì¥ (ëŒ€ì‹œë³´ë“œì—ì„œ ì™”ìŒì„ í‘œì‹œ)
            sessionStorage.setItem('fromPage', 'dashboard');
            window.location.href = page;
        }
        
        // í˜ì´ì§€ ì´ë™ (ë©”ë‰´ì—ì„œ)
        function navigateToPageFromMenu(page) {
            // History state ì €ì¥ (ë©”ë‰´ì—ì„œ ì™”ìŒì„ í‘œì‹œ)
            sessionStorage.setItem('fromPage', 'menu');
            window.location.href = page;
        }
        
        // ë¡œê·¸ì•„ì›ƒ
        async function logout() {
            const confirmed = await showConfirm('ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
            if (confirmed) {
                sessionStorage.clear();
                localStorage.removeItem('user');
                localStorage.removeItem('user_type');
                showToast('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤', 'info', 1500);
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 1500);
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', () => {
            // í”„ë¡œí•„ì—ì„œ ëŒì•„ì˜¨ ê²½ìš° ë©”ë‰´ë¡œ ì „í™˜
            const returnToMenu = sessionStorage.getItem('returnToMenu');
            if (returnToMenu === 'true') {
                sessionStorage.removeItem('returnToMenu');
                // ì´ˆê¸°í™” í›„ ë©”ë‰´ë¡œ ì „í™˜
                initializePage();
                setTimeout(() => {
                    switchPage('menu');
                }, 100);
            } else {
                initializePage();
            }
            
            // ë©”ë‰´ë¡œ ì „í™˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            window.addEventListener('switchToMenu', () => {
                switchPage('menu');
            });
        });
    </script>
    
    <!-- PWA Service Worker ë“±ë¡ -->
    <script>
        // Service Worker ë“±ë¡ (PWA)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/mobile/sw.js')
                    .then((registration) => {
                        console.log('âœ… Service Worker registered:', registration.scope);
                    })
                    .catch((error) => {
                        console.error('âŒ Service Worker registration failed:', error);
                    });
            });
        }
        
        // í™ˆ í™”ë©´ ì¶”ê°€ ì•ˆë‚´ (iOS)
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('ğŸ’¾ Install prompt available');
            e.preventDefault();
            deferredPrompt = e;
            
            // ì„¤ì¹˜ ì•ˆë‚´ í‘œì‹œ (ì„ íƒì‚¬í•­)
            // showInstallPromotion();
        });
        
        // ì„¤ì¹˜ ì™„ë£Œ ê°ì§€
        window.addEventListener('appinstalled', () => {
            console.log('âœ… PWA installed successfully');
            deferredPrompt = null;
        });
        
        // Standalone ëª¨ë“œ ê°ì§€
        if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
            console.log('ğŸ“± Running in standalone mode (PWA)');
            document.body.classList.add('standalone-mode');
        }
    </script>
</body>
</html>
