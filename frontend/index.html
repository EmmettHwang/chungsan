<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="description" content="êµìœ¡ ê¸°ê´€ì˜ ê°•ì‚¬, í•™ìƒ, ìƒë‹´, í›ˆë ¨ì¼ì§€ë¥¼ í†µí•© ê´€ë¦¬í•˜ëŠ” ìŠ¤ë§ˆíŠ¸ êµìœ¡ê´€ë¦¬ í”Œë«í¼">
    <meta name="theme-color" content="#3B82F6">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="BH2025">
    
    <title>êµìœ¡ê´€ë¦¬ì‹œìŠ¤í…œ</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Favicon and Icons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="72x72" href="/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="96x96" href="/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="128x128" href="/icon-128x128.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/icon-192x192.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.0/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>

    <!-- Excel ë‚´ë³´ë‚´ê¸° ë¼ì´ë¸ŒëŸ¬ë¦¬ (SheetJS) -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <link href="/pwa-styles.css" rel="stylesheet">
    
    <style>
        /* ë§ˆí¬ë‹¤ìš´ ë¯¸ë¦¬ë³´ê¸° ìŠ¤íƒ€ì¼ */
        .prose {
            max-width: none;
        }
        .prose h1 { font-size: 2em; font-weight: bold; margin-top: 0.5em; margin-bottom: 0.5em; }
        .prose h2 { font-size: 1.5em; font-weight: bold; margin-top: 0.5em; margin-bottom: 0.5em; }
        .prose h3 { font-size: 1.25em; font-weight: bold; margin-top: 0.5em; margin-bottom: 0.5em; }
        .prose p { margin-top: 0.5em; margin-bottom: 0.5em; line-height: 1.6; }
        .prose ul, .prose ol { margin-left: 1.5em; margin-top: 0.5em; margin-bottom: 0.5em; }
        .prose li { margin-top: 0.25em; margin-bottom: 0.25em; }
        .prose a { color: #3b82f6; text-decoration: underline; }
        .prose a:hover { color: #2563eb; }
        .prose code { background-color: #f3f4f6; padding: 0.2em 0.4em; border-radius: 0.25rem; font-size: 0.9em; }
        .prose pre { background-color: #1f2937; color: #f3f4f6; padding: 1em; border-radius: 0.5rem; overflow-x: auto; margin-top: 0.5em; margin-bottom: 0.5em; }
        .prose pre code { background-color: transparent; padding: 0; color: inherit; }
        .prose blockquote { border-left: 4px solid #d1d5db; padding-left: 1em; color: #6b7280; margin-top: 0.5em; margin-bottom: 0.5em; }
        .prose strong { font-weight: bold; }
        .prose em { font-style: italic; }
        .prose hr { border-top: 1px solid #e5e7eb; margin-top: 1em; margin-bottom: 1em; }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        /* RAG Toggle Switch */
        .slider {
            background-color: #cbd5e1; /* OFF ìƒíƒœ: íšŒìƒ‰ */
        }
        .switch input:checked + .slider {
            background-color: #10b981; /* ON ìƒíƒœ: ì´ˆë¡ìƒ‰ */
        }
        .switch input:checked + .slider:before {
            transform: translateX(20px);
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

    </style>
    
    <!-- ë””ë°”ì´ìŠ¤ ê°ì§€ ë° ë¦¬ë‹¤ì´ë ‰ì…˜ (ìµœìš°ì„  ì‹¤í–‰) -->
    <script>
        (function() {
            // ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤ ê°ì§€ í•¨ìˆ˜
            function isMobileDevice() {
                // 1. User Agent ì²´í¬
                const ua = navigator.userAgent || navigator.vendor || window.opera;
                const mobileRegex = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i;
                
                // 2. í™”ë©´ í¬ê¸° ì²´í¬ (768px ì´í•˜)
                const isSmallScreen = window.innerWidth <= 768;
                
                // 3. í„°ì¹˜ ìŠ¤í¬ë¦° ì²´í¬
                const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
                
                // User Agentê°€ ëª¨ë°”ì¼ì´ê±°ë‚˜, ì‘ì€ í™”ë©´ + í„°ì¹˜ì¸ ê²½ìš°
                return mobileRegex.test(ua) || (isSmallScreen && isTouchDevice);
            }
            
            // ì´ë¯¸ ëª¨ë°”ì¼ í˜ì´ì§€ì— ìˆëŠ”ì§€ ì²´í¬ (ë¬´í•œ ë£¨í”„ ë°©ì§€)
            const currentPath = window.location.pathname;
            const isAlreadyOnMobile = currentPath.includes('/mobile/');
            const isLoginPage = currentPath.includes('/login.html');
            
            // ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤ì´ê³ , ì•„ì§ ëª¨ë°”ì¼ í˜ì´ì§€ê°€ ì•„ë‹ˆê³ , ë¡œê·¸ì¸ í˜ì´ì§€ë„ ì•„ë‹Œ ê²½ìš°
            if (isMobileDevice() && !isAlreadyOnMobile && !isLoginPage) {
                console.log('ğŸ“± ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤ ê°ì§€ - ëª¨ë°”ì¼ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸');
                window.location.replace('/mobile/login.html');
                return; // ì´í›„ ì½”ë“œ ì‹¤í–‰ ì¤‘ë‹¨
            }
            
            console.log('ğŸ’» ë°ìŠ¤í¬íƒ‘ ë””ë°”ì´ìŠ¤ - ë°ìŠ¤í¬íƒ‘ í˜ì´ì§€ ë¡œë“œ');
        })();
    </script>
    
    <!-- ë¡œê·¸ì¸ ì²´í¬ (ì¦‰ì‹œ ì‹¤í–‰) - sessionStorage ì‚¬ìš© (ë¸Œë¼ìš°ì € ë‹«ìœ¼ë©´ ì„¸ì…˜ ì‚­ì œ) -->
    <script>
        (function() {
            console.log('ğŸ”’ ì¦‰ì‹œ ë¡œê·¸ì¸ ì²´í¬ ì‹¤í–‰');
            const loggedIn = sessionStorage.getItem('logged_in');
            const instructor = sessionStorage.getItem('instructor');
            
            // ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ìœ¼ë©´ ì¦‰ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            if (!loggedIn || loggedIn !== 'true' || !instructor) {
                console.log('âŒ ë¡œê·¸ì¸ ì•ˆ ë¨ - ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì¦‰ì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸');
                window.location.replace('/login.html');
                // í˜ì´ì§€ ë¡œë”© ì¤‘ë‹¨
                document.addEventListener('DOMContentLoaded', function(e) {
                    e.stopImmediatePropagation();
                }, true);
            } else {
                console.log('âœ… ë¡œê·¸ì¸ í™•ì¸ë¨ - í˜ì´ì§€ ë¡œë“œ ê³„ì†');
            }
        })();
    </script>

    <!-- í…Œë§ˆ ë° íƒ€ì´í‹€ ì¦‰ì‹œ ì ìš© (í˜ì´ì§€ ë Œë”ë§ ì „) -->
    <script>
        (function() {
            try {
                // í…Œë§ˆ ìƒ‰ìƒ ì¦‰ì‹œ ì ìš©
                const savedTheme = localStorage.getItem('system_theme');
                if (savedTheme) {
                    const theme = JSON.parse(savedTheme);
                    const themeColor = theme.menubar;
                    if (themeColor) {
                        const style = document.createElement('style');
                        style.id = 'instant-theme';
                        style.textContent = `
                            header.instant-theme-header { background-color: ${themeColor} !important; }
                            .text-blue-100 { color: rgba(255,255,255,0.8) !important; }
                            .text-blue-200 { color: rgba(255,255,255,0.7) !important; }
                        `;
                        document.head.appendChild(style);
                        window.__INSTANT_THEME_COLOR__ = themeColor;
                    }
                }

                // ë¸Œë¼ìš°ì € íƒ€ì´í‹€ ì¦‰ì‹œ ì ìš©
                const savedTitle = localStorage.getItem('system_title');
                if (savedTitle) {
                    document.title = savedTitle;
                }

                // íŒŒë¹„ì½˜ì„ ë¡œê³ ë¡œ ì„¤ì •
                const logoUrl = localStorage.getItem('logo_url');
                if (logoUrl) {
                    let faviconUrl = logoUrl;
                    if (logoUrl.startsWith('ftp://')) {
                        faviconUrl = '/api/download-image?url=' + encodeURIComponent(logoUrl);
                    }
                    const favicon = document.querySelector('link[rel="icon"]');
                    if (favicon) {
                        favicon.href = faviconUrl;
                    }
                }
            } catch(e) {
                console.log('ì´ˆê¸° ì„¤ì • ì ìš© ì‹¤íŒ¨:', e);
            }
        })();
    </script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- í—¤ë” -->
        <header class="bg-blue-600 text-white shadow-lg relative z-30 instant-theme-header">
            <div class="container mx-auto px-4 py-6">
                <div class="flex justify-between items-start">
                    <div class="flex items-center gap-4 cursor-pointer hover:opacity-80 transition-opacity" onclick="showTab('dashboard')" title="ëŒ€ì‹œë³´ë“œë¡œ ì´ë™">
                        <div class="bg-white rounded-lg overflow-hidden shadow-md" style="width: 200px; height: 80px;">
                            <img id="header-logo" src="" alt="ë¡œê³ " style="width: 100%; height: 100%; object-fit: fill; display:none;">
                        </div>
                        <div>
                            <h1 id="system-title-header" class="text-3xl font-bold flex items-center">
                                <i class="fas fa-school mr-3"></i>
                                <span id="system-title-text">ë¡œë”©ì¤‘...</span>
                                <span id="version-badge" class="ml-3 text-sm font-normal px-2 py-1 rounded" style="background: rgba(255,255,255,0.2); backdrop-filter: blur(4px);"></span>
                            </h1>
                            <p id="system-subtitle1-header" class="text-blue-100 mt-1">ë³´ê±´ë³µì§€ë¶€(í•œêµ­ë³´ê±´ì‚°ì—…ì§„í¥ì›), KDT, ìš°ì†¡ëŒ€í•™êµì‚°í•™í˜‘ë ¥ë‹¨</p>
                            <p id="system-subtitle2-header" class="text-blue-100">ë°”ì´ì˜¤í—¬ìŠ¤ì•„ì¹´ë°ë¯¸ ì˜¬ì¸ì›í…Œí¬ ì´ë…¸ë² ì´í„°</p>
                        </div>
                    </div>
                    <div class="flex flex-col gap-3">
                        <!-- ìƒë‹¨: ì‚¬ìš©ì ì •ë³´ + ë²„íŠ¼ë“¤ (ë§¤ìš° ì–‡ê²Œ) -->
                        <div class="flex items-center justify-end gap-2">
                            <!-- ì‚¬ìš©ì ì •ë³´ -->
                            <div id="userInfo" class="text-right">
                                <p class="text-xs text-blue-100">ë¡œê·¸ì¸: <span id="instructorName" class="font-semibold text-white"></span> / <span id="instructorType" class="text-blue-200"></span></p>
                            </div>
                            
                            <!-- ë²„íŠ¼ë“¤ (ë§¤ìš° ì–‡ê²Œ) -->
                            <button onclick="showMyPageModal()" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-0.5 rounded text-xs transition-all">
                                <i class="fas fa-user-circle mr-1"></i>MyPage
                            </button>
                            <button onclick="logout()" class="bg-white text-blue-600 hover:bg-blue-50 px-2 py-0.5 rounded text-xs transition-all">
                                <i class="fas fa-sign-out-alt mr-1"></i>ë¡œê·¸ì•„ì›ƒ
                            </button>
                        </div>
                        
                        <!-- í•˜ë‹¨: ë‚ ì§œ/ì‹œê°„ + ì¹´ìš´íŠ¸ë‹¤ìš´ ë°” (ì–‡ê²Œ) -->
                        <div id="datetime-container" class="flex items-center justify-between rounded px-3 py-1" style="background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.25);">
                            <span class="text-white text-xs" id="currentDateTime">
                                <i class="fas fa-calendar-day mr-1"></i>ë¡œë”© ì¤‘...
                            </span>
                            <span class="text-white text-opacity-80 text-xs" id="refreshCountdownContainer" style="display: none;">
                                <i class="fas fa-sync-alt mr-1"></i>ìƒˆë¡œê³ ì¹¨: <span id="refresh-countdown" class="font-mono text-white">--:--</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- ì‹œìŠ¤í…œ ì„¤ì • ì¦‰ì‹œ ë¡œë“œ -->
        <script>
            (async function() {
                try {
                    const response = await fetch('/api/system-settings');
                    const settings = await response.json();

                    // ë¡œê³  ì¦‰ì‹œ í‘œì‹œ
                    const logo = document.getElementById('header-logo');
                    if (logo && settings.logo_url) {
                        if (settings.logo_url.startsWith('ftp://')) {
                            logo.src = '/api/download-image?url=' + encodeURIComponent(settings.logo_url);
                        } else {
                            logo.src = settings.logo_url;
                        }
                        logo.style.display = '';
                    }

                    // ì œëª© ì¦‰ì‹œ í‘œì‹œ
                    const titleText = document.getElementById('system-title-text');
                    if (titleText) {
                        titleText.textContent = settings.system_title || 'ë°”ì´ì˜¤í—¬ìŠ¤êµìœ¡ê´€ë¦¬ì‹œìŠ¤í…œ';
                    }

                    // ë¶€ì œëª© í‘œì‹œ
                    const sub1 = document.getElementById('system-subtitle1-header');
                    const sub2 = document.getElementById('system-subtitle2-header');
                    if (sub1) sub1.textContent = settings.system_subtitle1 || '';
                    if (sub2) sub2.textContent = settings.system_subtitle2 || '';

                } catch (e) {
                    console.log('ì‹œìŠ¤í…œ ì„¤ì • ë¡œë“œ ì¤‘...');
                }
            })();
        </script>

        <!-- ë„¤ë¹„ê²Œì´ì…˜ íƒ­ (2ë‹¨ ë©”ë‰´) -->
        <nav class="bg-white shadow-md relative z-40">
            <div class="container mx-auto px-4">
                <div class="flex space-x-1 border-b border-gray-200">
                    <!-- ëŒ€ì‹œë³´ë“œ -->
                    <button onclick="showTab('dashboard')" class="tab-btn px-4 py-3 text-sm font-semibold text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-t bg-blue-50 text-blue-600" data-tab="dashboard">
                        <i class="fas fa-tachometer-alt mr-1"></i>ëŒ€ì‹œë³´ë“œ
                    </button>
                    
                    <!-- ì‹œìŠ¤í…œê´€ë¦¬ ë©”ë‰´ -->
                    <div class="relative group">
                        <button class="px-4 py-3 text-sm font-semibold text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-t">
                            <i class="fas fa-cogs mr-1"></i>ì‹œìŠ¤í…œê´€ë¦¬
                            <i class="fas fa-chevron-down ml-1 text-xs"></i>
                        </button>
                        <div class="hidden group-hover:flex absolute left-0 top-full bg-white shadow-lg rounded-b z-50 w-[300px] flex-col">
                            <button onclick="showTab('instructor-codes')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="instructor-codes" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-user-shield mr-2" style="width: 16px;"></i>ê°•ì‚¬ì½”ë“œ/ê¶Œí•œ
                            </button>
                            <button onclick="showTab('instructors')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="instructors" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-user-tie mr-2" style="width: 16px;"></i>ê°•ì‚¬ê´€ë¦¬
                            </button>
                            <button onclick="showTab('system-settings')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="system-settings" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-cog mr-2" style="width: 16px;"></i>ì‹œìŠ¤í…œ ë“±ë¡
                            </button>
                            <button onclick="showTab('backup-manager')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="backup-manager" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-database mr-2" style="width: 16px;"></i>DB ê´€ë¦¬
                            </button>
                            <button onclick="showTab('notices')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="notices" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-bullhorn mr-2" style="width: 16px;"></i>ê³µì§€ì‚¬í•­
                            </button>
                            <button onclick="showTab('system-check')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="system-check" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-stethoscope mr-2" style="width: 16px;"></i>ì‹œìŠ¤í…œ ì ê²€
                            </button>
                        </div>
                    </div>

                    <!-- ê³¼ì • ë©”ë‰´ -->
                    <div class="relative group">
                        <button class="px-4 py-3 text-sm font-semibold text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-t">
                            <i class="fas fa-graduation-cap mr-1"></i>ê³¼ì •
                            <i class="fas fa-chevron-down ml-1 text-xs"></i>
                        </button>
                        <div class="hidden group-hover:flex absolute left-0 top-full bg-white shadow-lg rounded-b z-50 w-[300px] flex-col">
                            <button onclick="showTab('subjects')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="subjects" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-book mr-2" style="width: 16px;"></i>êµê³¼ëª©
                            </button>
                            <button onclick="showTab('holidays')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="holidays" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-calendar-alt mr-2" style="width: 16px;"></i>ê³µíœ´ì¼
                            </button>
                            <button onclick="showTab('courses')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="courses" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-school mr-2" style="width: 16px;"></i>ê³¼ì •ê´€ë¦¬
                            </button>
                        </div>
                    </div>
                    
                    <!-- í•™ìƒ ë©”ë‰´ -->
                    <div class="relative group">
                        <button class="px-4 py-3 text-sm font-semibold text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-t">
                            <i class="fas fa-user-graduate mr-1"></i>í•™ìƒ
                            <i class="fas fa-chevron-down ml-1 text-xs"></i>
                        </button>
                        <div class="hidden group-hover:flex absolute left-0 top-full bg-white shadow-lg rounded-b z-50 w-[300px] flex-col">
                            <button onclick="showTab('students')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50 bg-blue-50 text-blue-600" data-tab="students" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-users mr-2" style="width: 16px;"></i>í•™ìƒê´€ë¦¬
                            </button>
                            <button onclick="showTab('counselings')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="counselings" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-comments mr-2" style="width: 16px;"></i>ìƒë‹´ê´€ë¦¬
                            </button>
                        </div>
                    </div>
                    
                    <!-- ê°•ì˜ ë©”ë‰´ -->
                    <div class="relative group">
                        <button class="px-4 py-3 text-sm font-semibold text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-t">
                            <i class="fas fa-chalkboard mr-1"></i>ê°•ì˜
                            <i class="fas fa-chevron-down ml-1 text-xs"></i>
                        </button>
                        <div class="hidden group-hover:flex absolute left-0 top-full bg-white shadow-lg rounded-b z-50 w-[300px] flex-col">
                            <button onclick="showTab('timetables')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="timetables" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-clock mr-2" style="width: 16px;"></i>ì‹œê°„í‘œ
                            </button>
                            <button onclick="showTab('training-logs')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="training-logs" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-clipboard-list mr-2" style="width: 16px;"></i>í›ˆë ¨ì¼ì§€ ê´€ë¦¬
                            </button>
                            <button onclick="showTab('rag-documents')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="rag-documents" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-file-alt mr-2" style="width: 16px;"></i>ë¬¸ì„œ ê´€ë¦¬ (RAG)
                            </button>
                        </div>
                    </div>

                    <!-- ì„±ì  ë©”ë‰´ -->
                    <div class="relative group">
                        <button class="px-4 py-3 text-sm font-semibold text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-t">
                            <i class="fas fa-chart-line mr-1"></i>ì„±ì 
                            <i class="fas fa-chevron-down ml-1 text-xs"></i>
                        </button>
                        <div class="hidden group-hover:flex absolute left-0 top-full bg-white shadow-lg rounded-b z-50 w-[300px] flex-col">
                            <button onclick="showTab('exam-bank')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="exam-bank" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-clipboard-question mr-2" style="width: 16px;"></i>ë¬¸ì œì€í–‰
                            </button>
                            <button onclick="showTab('online-exam')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="online-exam" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-laptop mr-2" style="width: 16px;"></i>ì˜¨ë¼ì¸ì‹œí—˜
                            </button>
                            <button onclick="showTab('quick-quiz')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="quick-quiz" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-bolt mr-2" style="width: 16px;"></i>ì„ ì°©ìˆœ í€´ì¦ˆ
                            </button>
                            <button onclick="showTab('assignments')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="assignments" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-tasks mr-2" style="width: 16px;"></i>ê³¼ì œê´€ë¦¬
                            </button>
                        </div>
                    </div>

                    <!-- AI ë©”ë‰´ -->
                    <div class="relative group">
                        <button class="px-4 py-3 text-sm font-semibold text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-t">
                            <i class="fas fa-robot mr-1"></i>AI
                            <i class="fas fa-chevron-down ml-1 text-xs"></i>
                        </button>
                        <div class="hidden group-hover:flex absolute left-0 top-full bg-white shadow-lg rounded-b z-50 w-[300px] flex-col">
                            <button onclick="showTab('class-notes')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="class-notes" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-book-open mr-2" style="width: 16px;"></i>SSIRNë©”ëª¨ì¥(ìˆ˜ì—…,ê¸°ì–µ,ì •ë³´,etc)
                            </button>
                            <button onclick="showTab('ai-report')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="ai-report" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-file-alt mr-2" style="width: 16px;"></i>AI ìƒê¸°ë¶€
                            </button>
                            <button onclick="showTab('ai-timetable')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="ai-timetable" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-calendar-alt mr-2" style="width: 16px;"></i>AI ì‹œê°„í‘œ
                            </button>
                            <button onclick="showTab('ai-training-log')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="ai-training-log" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-brain mr-2" style="width: 16px;"></i>AI í›ˆë ¨ì¼ì§€
                            </button>
                            <button onclick="showTab('ai-counseling')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="ai-counseling" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-comments mr-2" style="width: 16px;"></i>AI ìƒë‹´ì¼ì§€
                            </button>
                            <button onclick="showTab('aesong-3d-chat')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="aesong-3d-chat" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-robot mr-2" style="width: 16px;"></i>ğŸ¶ ì˜ˆì§„ì´ ë§Œë‚˜ê¸°
                            </button>
                        </div>
                    </div>
                    
                    <!-- íŒ€ ë©”ë‰´ (ë“œë¡­ë‹¤ìš´) -->
                    <div class="relative group">
                        <button class="px-4 py-3 text-sm font-semibold text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-t">
                            <i class="fas fa-users mr-1"></i>íŒ€
                            <i class="fas fa-chevron-down ml-1 text-xs"></i>
                        </button>
                        <div class="hidden group-hover:flex absolute left-0 top-full bg-white shadow-lg rounded-b z-50 w-[300px] flex-col">
                            <button onclick="showTab('projects')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="projects" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-users mr-2" style="width: 16px;"></i>íŒ€ ê´€ë¦¬
                            </button>
                            <button onclick="showTab('team-activity-logs')" class="tab-btn flex items-center w-full px-3 py-2 text-sm hover:bg-blue-50" data-tab="team-activity-logs" style="justify-content: flex-start !important; text-align: left !important;">
                                <i class="fas fa-clipboard-list mr-2" style="width: 16px;"></i>íŒ€ í™œë™ì¼ì§€
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </nav>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <main class="container mx-auto px-4 py-8">
            <div id="app">
                <div class="text-center py-8">
                    <i class="fas fa-spinner fa-spin text-4xl text-blue-600"></i>
                    <p class="text-gray-600 mt-4">ë¡œë”© ì¤‘...</p>
                </div>
            </div>
            
            <!-- ê³¼ì • ì¶”ê°€/ìˆ˜ì • í¼ (ëª¨ë‹¬) -->
            <div id="course-form" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                <div class="bg-white rounded-lg shadow-xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <!-- í¼ ë‚´ìš©ì€ JavaScriptì—ì„œ ë™ì  ìƒì„± -->
                </div>
            </div>
            
            <!-- êµê³¼ëª© ì„ íƒ ëª¨ë‹¬ -->
            <div id="subject-selector" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div class="bg-white rounded-xl shadow-2xl p-8 max-w-7xl w-full max-h-[90vh] overflow-hidden flex flex-col">
                    <!-- ë‚´ìš©ì€ JavaScriptì—ì„œ ë™ì  ìƒì„± -->
                </div>
            </div>
            
            <!-- ì»¤ìŠ¤í…€ ì•Œë¦¼ ëª¨ë‹¬ -->
            <div id="custom-alert" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[10001] animate-fade-in">
                <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 animate-scale-in">
                    <!-- ì•„ì´ì½˜ -->
                    <div class="flex justify-center mb-4">
                        <div id="alert-icon-container" class="bg-blue-100 rounded-full p-4">
                            <i id="alert-icon" class="fas fa-info-circle text-4xl text-blue-600"></i>
                        </div>
                    </div>
                    
                    <!-- ì œëª© -->
                    <h3 id="alert-title" class="text-xl font-bold text-gray-900 text-center mb-3">
                        ì•Œë¦¼
                    </h3>
                    
                    <!-- ë©”ì‹œì§€ -->
                    <p id="alert-message" class="text-gray-600 text-center mb-6 whitespace-pre-line leading-relaxed">
                    </p>
                    
                    <!-- ë²„íŠ¼ -->
                    <div class="flex justify-center">
                        <button onclick="window.hideAlert()" 
                                class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-semibold transition-all transform hover:scale-105 shadow-lg">
                            <i class="fas fa-check mr-2"></i>í™•ì¸
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ì»¤ìŠ¤í…€ í™•ì¸ ëª¨ë‹¬ -->
            <div id="custom-confirm" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[10001] animate-fade-in">
                <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 animate-scale-in">
                    <!-- ì•„ì´ì½˜ -->
                    <div class="flex justify-center mb-4">
                        <div class="bg-red-100 rounded-full p-4">
                            <i class="fas fa-exclamation-triangle text-4xl text-red-600"></i>
                        </div>
                    </div>
                    
                    <!-- ì œëª© -->
                    <h3 id="confirm-title" class="text-xl font-bold text-gray-900 text-center mb-3">
                        ì‚­ì œ í™•ì¸
                    </h3>
                    
                    <!-- ë©”ì‹œì§€ -->
                    <p id="confirm-message" class="text-gray-600 text-center mb-6 whitespace-pre-line leading-relaxed">
                        ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
                    </p>
                    
                    <!-- ë²„íŠ¼ -->
                    <div class="flex gap-3">
                        <button onclick="window.handleConfirm(false)" 
                                class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-3 rounded-lg font-semibold transition-all transform hover:scale-105">
                            <i class="fas fa-times mr-2"></i>ì·¨ì†Œ
                        </button>
                        <button onclick="window.handleConfirm(true)" 
                                class="flex-1 bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold transition-all transform hover:scale-105">
                            <i class="fas fa-trash-alt mr-2"></i>ì‚­ì œ
                        </button>
                    </div>
                </div>
            </div>
            
            <style>
                @keyframes fade-in {
                    from {
                        opacity: 0;
                    }
                    to {
                        opacity: 1;
                    }
                }
                
                @keyframes scale-in {
                    from {
                        transform: scale(0.9);
                        opacity: 0;
                    }
                    to {
                        transform: scale(1);
                        opacity: 1;
                    }
                }
                
                .animate-fade-in {
                    animation: fade-in 0.2s ease-out;
                }
                
                .animate-scale-in {
                    animation: scale-in 0.3s ease-out;
                }
            </style>
            
            <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
            <div id="loading-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70]">
                <div class="bg-white rounded-lg shadow-xl p-8 max-w-md w-full mx-4">
                    <div class="text-center">
                        <div class="mb-4">
                            <i class="fas fa-spinner fa-spin text-5xl text-blue-600"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">ë°ì´í„° ë¡œë”© ì¤‘</h3>
                        <p class="text-gray-600 mb-4">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</p>
                        
                        <!-- í”„ë¡œê·¸ë ˆìŠ¤ ë°” -->
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mb-2">
                            <div id="loading-progress" class="bg-blue-600 h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <p id="loading-message" class="text-sm text-gray-500">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                </div>
            </div>

            <!-- í•™ìƒ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
            <div id="student-detail" class="hidden"></div>
            
            <!-- ì˜ˆìœ ì•Œë¦¼ ëª¨ë‹¬ -->
            <div id="alert-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4">
                <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] flex flex-col transform transition-all">
                    <div id="alert-header" class="p-6 rounded-t-2xl flex-shrink-0">
                        <div class="flex items-center gap-4">
                            <div id="alert-icon" class="text-4xl"></div>
                            <h3 id="alert-title" class="text-xl font-bold text-white"></h3>
                        </div>
                    </div>
                    <div class="overflow-y-auto flex-1 px-6 py-4">
                        <p id="alert-message" class="text-gray-700 text-lg leading-relaxed whitespace-pre-line"></p>
                    </div>
                    <div class="p-6 pt-4 flex justify-end gap-3 flex-shrink-0 border-t border-gray-200">
                        <button id="alert-cancel-btn" class="hidden px-6 py-2.5 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-semibold transition-colors">
                            ì·¨ì†Œ
                        </button>
                        <button id="alert-confirm-btn" class="px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition-colors">
                            í™•ì¸
                        </button>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- ì „ì—­ í”Œë¡œíŒ… ì±—ë´‡ (ëª¨ë“  í˜ì´ì§€ì—ì„œ ì‚¬ìš© ê°€ëŠ¥) -->
        <div id="global-floating-chatbot">
            <!-- ì±—ë´‡ ìœ„ì ¯ (ì²˜ìŒì—” ìˆ¨ê¹€) -->
            <div id="chatbot-widget" style="display: none; position: fixed; bottom: 90px; right: 20px; width: 650px; max-height: 700px; background: white; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); z-index: 1000; flex-direction: column;">
                <!-- ì±—ë´‡ í—¤ë” -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 15px 15px 0 0; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: 40px; height: 40px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                            ğŸ¶
                        </div>
                        <div>
                            <div style="font-weight: bold; font-size: 16px;">ì˜ˆì§„ì´</div>
                            <div style="font-size: 12px; opacity: 0.9;">AI ì–´ì‹œìŠ¤í„´íŠ¸</div>
                        </div>
                    </div>
                    <button onclick="window.toggleChatbot()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background 0.3s;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- ì±—ë´‡ ë©”ì‹œì§€ ì˜ì—­ -->
                <div id="chatbot-messages" style="flex: 1; padding: 15px; overflow-y: auto; max-height: 550px; background: #f9fafb;">
                    <div class="chatbot-message bot-message" style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <div style="width: 30px; height: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0;">
                            ğŸ¶
                        </div>
                        <div style="background: white; padding: 10px 15px; border-radius: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); max-width: 70%;">
                            <div style="font-size: 14px; color: #374151;">ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” ì˜ˆì§„ì´ì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”? ğŸ˜Š</div>
                        </div>
                    </div>
                </div>
                
                <!-- ì±—ë´‡ ì…ë ¥ ì˜ì—­ -->
                <div style="padding: 15px; border-top: 1px solid #e5e7eb; background: white; border-radius: 0 0 15px 15px;">
                    <!-- RAG í† ê¸€ -->
                    <div style="margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; padding: 8px 12px; background: #f3f4f6; border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-database" style="color: #667eea; font-size: 14px;"></i>
                            <span style="font-size: 13px; color: #374151; font-weight: 500;">RAG ê²€ìƒ‰ ì‚¬ìš©</span>
                        </div>
                        <label class="switch" style="position: relative; display: inline-block; width: 44px; height: 24px;">
                            <input type="checkbox" id="rag-mode-toggle" checked style="opacity: 0; width: 0; height: 0;">
                            <span class="slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; transition: .4s; border-radius: 24px;"></span>
                        </label>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="chatbot-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." 
                               style="flex: 1; padding: 10px 15px; border: 2px solid #e5e7eb; border-radius: 25px; outline: none; font-size: 14px;"
                               onkeypress="if(event.key==='Enter'){window.sendChatMessage();}">
                        <button onclick="window.sendChatMessage()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: transform 0.2s;">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- í”Œë¡œíŒ… ë²„íŠ¼ -->
            <button id="chatbot-toggle-btn" onclick="window.toggleChatbot()" 
                    style="position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 50%; cursor: pointer; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); display: flex; align-items: center; justify-content: center; font-size: 24px; z-index: 999; transition: transform 0.3s, box-shadow 0.3s;">
                <i class="fas fa-comments"></i>
            </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    
    <!-- ì™„ì „ ìºì‹œ ì œê±° (ë¡œê·¸ì¸ ì •ë³´ëŠ” ìœ ì§€) -->
    <script>
        // ì„œë¹„ìŠ¤ ì›Œì»¤ ì™„ì „ ì œê±°
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for(let registration of registrations) {
                    registration.unregister();
                }
            });
        }
        
        // ëª¨ë“  ìºì‹œ ìŠ¤í† ë¦¬ì§€ ì‚­ì œ
        if ('caches' in window) {
            caches.keys().then(function(names) {
                for (let name of names) {
                    caches.delete(name);
                }
            });
        }
        
        // ìºì‹œë§Œ ì‚­ì œ (ë¡œê·¸ì¸ ì •ë³´ëŠ” ìœ ì§€)
        const keysToRemove = [];
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key && key.startsWith('cache_')) {
                keysToRemove.push(key);
            }
        }
        keysToRemove.forEach(key => localStorage.removeItem(key));
    </script>
    
    <!-- ìºì‹œ ë²„ìŠ¤íŒ…ì„ ìœ„í•œ ë²„ì „ ì¿¼ë¦¬ -->
    <script src="/app.js?v=5.6.9"></script>
    
    <!-- 3D ëª¨ë“ˆ (Three.js) -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    <script type="module" src="/screensaver-3d.js"></script>
    <script type="module" src="/aesong-3d-module.js?v=2.0.220"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Service Worker ì™„ì „ ë¹„í™œì„±í™”
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for(let registration of registrations) {
                    registration.unregister();
                    console.log('Service Worker unregistered');
                }
            });
        }
        
        // ì•„ë˜ ì½”ë“œëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
        if (false) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then((registration) => 